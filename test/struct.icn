#SRC: V9GEN

import io, ipl.test

record array(a,b,c,d,e,f,g)

procedure p1()
   write(" ----> ",imagex() | "none")
   write("list(0) ----> ",imagex(list(0)) | "none")
   write("list(0,1) ----> ",imagex(list(0,1)) | "none")
   write("list(1,1) ----> ",imagex(list(1,1)) | "none")
   write("list(100,\"a\") ----> ",imagex(list(100,"a")) | "none")
   write("table() ----> ",imagex(table()) | "none")
   write("table(0) ----> ",imagex(table(0)) | "none")
   write("a := [] ----> ",imagex(a := []) | "none")
   write("every put(a,!&lcase) ----> ",imagex(every put(a,!&lcase)) | "none")
   write("a1 := sort(a) ----> ",imagex(a1 := sort(a)) | "none")
   write("every write(!a1) ----> ",imagex(every write(!a1)) | "none")
end

procedure p2()
   write("sort(a1) ----> ",imagex(sort(a1)) | "none")
   write("t := table() ----> ",imagex(t := table()) | "none")
   write("every t[!&lcase] := 1 ----> ",imagex(every t[!&lcase] := 1) | "none")
   write("sort(t) ----> ",imagex(sort(t)) | "none")
   write("a := sort(t) ----> ",imagex(a := sort(t)) | "none")
   write("every write((!a)[1]) ----> ",imagex(every write((!a)[1])) | "none")
   write("every write((!a)[2]) ----> ",imagex(every write((!a)[2])) | "none")
   write("set(1,0,1,0,1,0,1,0) ----> ",imagex(set(1,0,1,0,1,0,1,0)) | "none")
   write("set() ----> ",imagex(set()) | "none")
   write("s := set(1,2,3,4,5,6,7,8,9,10) ----> ",imagex(s := set(1,2,3,4,5,6,7,8,9,10)) | "none")
   write("*s ----> ",imagex(*s) | "none")
end

procedure p3()
   write("every write(!sort(s)) ----> ",imagex(every write(!sort(s))) | "none")
   write("*copy(s) ----> ",imagex(*copy(s)) | "none")
   write("image(s) ----> ",imagex(imagex(s)) | "none")
   write("type(s) ----> ",imagex(type(s)) | "none")
   write("member(s,8) ----> ",imagex(member(s,8)) | "none")
   write("member(s,\"8\") ----> ",imagex(member(s,"8")) | "none")
   write("s := set() ----> ",imagex(s := set()) | "none")
   write("every insert(s,1 to 100) ----> ",imagex(every insert(s,1 to 100)) | "none")
   write("*s ----> ",imagex(*s) | "none")
   write("every delete(s,15 to 30) ----> ",imagex(every delete(s,15 to 30)) | "none")
   write("*s ----> ",imagex(*s) | "none")
end

procedure p4()
   local s1,s2,s3,s4,s5
   write("every s1 := insert(set(),!&lcase) ----> ",imagex(every s1 := insert(set(),!&lcase)) | "none")
   write("s2 := set(\"a\",\"aa\",\"ab\",\"b\",1,2,3,4) ----> ",imagex(s2 := set("a","aa","ab","b",1,2,3,4)) | "none")
   write("s3 := s1 ++ s2 ----> ",imagex(s3 := s1 ++ s2) | "none")
   write("s4 := s1 ** s2 ----> ",imagex(s4 := s1 ** s2) | "none")
   write("s5 := s1 -- s2 ----> ",imagex(s5 := s1 -- s2) | "none")
   write("*s3 ----> ",imagex(*s3) | "none")
   write("*s4 ----> ",imagex(*s4) | "none")
   write("*s5 ----> ",imagex(*s5) | "none")
   write("t := table() ----> ",imagex(t := table()) | "none")
   write("every t[1 | &cset | [] | \"hello\" | main | 2 | table()] := ?100 ----> ",imagex(every t[1 | &cset | [] | "hello" | main | 2 | table()] := rand(100)) | "none")
   write("a := sort(t,3) ----> ",imagex(a := sort(t,3)) | "none")
end

procedure p5()
   local i
   write("every i := 1 to *a - 1 by 2 do write(imagex(a[i]),\" \",a[i + 1]) ----> ",imagex(every i := 1 to *a - 1 by 2 do write(imagex(a[i])," ",a[i + 1])) | "none")
   write("a := sort(t,4) ----> ",imagex(a := sort(t,4)) | "none")
   write("every i := 1 to *a - 1 by 2 do write(imagex(a[i]),\" \",a[i + 1]) ----> ",imagex(every i := 1 to *a - 1 by 2 do write(imagex(a[i])," ",a[i + 1])) | "none")
   write("t := table() ----> ",imagex(t := table()) | "none")
   write("every t[1 | &cset | [] | \"hello\" | main | 2 | table()] := ?100 ----> ",imagex(every t[1 | &cset | [] | "hello" | main | 2 | table()] := rand(100)) | "none")
   write("a := sort(t,3) ----> ",imagex(a := sort(t,3)) | "none")
   write("every i := 1 to *a - 1 by 2 do write(imagex(a[i]),\" \",a[i + 1]) ----> ",imagex(every i := 1 to *a - 1 by 2 do write(imagex(a[i])," ",a[i + 1])) | "none")
   write("a := sort(t,4) ----> ",imagex(a := sort(t,4)) | "none")
   write("every i := 1 to *a - 1 by 2 do write(imagex(a[i]),\" \",a[i + 1]) ----> ",imagex(every i := 1 to *a - 1 by 2 do write(imagex(a[i])," ",a[i + 1])) | "none")
   write("x := [array(),table(),write,[],1,\"abc\",'aa',&null] ----> ",imagex(x := [array(),table(),write,[],1,"abc",'aa',&null]) | "none")
   write("x := sort(x) ----> ",imagex(x := sort(x)) | "none")
end

procedure p6()
   write("every write(imagex(!x)) ----> ",imagex(every write(imagex(!x))) | "none")
   write("t := table(table()) ----> ",imagex(t := table(table())) | "none")
   write("every t[1 to 10] := 1 do write(imagex(t)) ----> ",imagex(every t[1 to 10] := 1 do write(imagex(t))) | "none")
   write("t := table() ----> ",imagex(t := table()) | "none")
   write("every t[1 to 10] := 1 do write(*t) ----> ",imagex(every t[1 to 10] := 1 do write(*t)) | "none")
   write("t[] := 6 ----> ",imagex(t[] := 6) | "none")
   write("t[] ----> ",imagex(t[]) | "none")
   write("*t ----> ",imagex(*t) | "none")
   write("t[&null] := 7 ----> ",imagex(t[&null] := 7) | "none")
   write("t[] ----> ",imagex(t[]) | "none")
   write("*t ----> ",imagex(*t) | "none")
end

procedure p7()
   write("x := [] ----> ",imagex(x := []) | "none")
   write("*x ----> ",imagex(*x) | "none")
   write("every push(x,1 to 10) ----> ",imagex(every push(x,1 to 10)) | "none")
   write("every 1 to 10 do write(pop(x)) ----> ",imagex(every 1 to 10 do write(pop(x))) | "none")
   write("*x ----> ",imagex(*x) | "none")
   write("pop(x) ----> ",imagex(pop(x)) | "none")
   write("pull(x) ----> ",imagex(pull(x)) | "none")
   write("get(x) ----> ",imagex(get(x)) | "none")
   write("every put(x,1 to 10) ----> ",imagex(every put(x,1 to 10)) | "none")
   write("every 1 to 10 do write(get(x)) ----> ",imagex(every 1 to 10 do write(get(x))) | "none")
   write("every push(x,1 to 10) ----> ",imagex(every push(x,1 to 10)) | "none")
end

procedure p8()
   write("every 1 to 10 do write(pull(x)) ----> ",imagex(every 1 to 10 do write(pull(x))) | "none")
   write("x := [1,2,3,4,5,6,7,8,9,0] ----> ",imagex(x := [1,2,3,4,5,6,7,8,9,0]) | "none")
   write("every write(imagex(x[1:0 to -20 by -1])) ----> ",imagex(every write(imagex(x[1:0 to -20 by -1]))) | "none")
   write("a := [1,2,3,4,5,6,7,8] ----> ",imagex(a := [1,2,3,4,5,6,7,8]) | "none")
   write("a1 := a[2:4] ----> ",imagex(a1 := a[2:4]) | "none")
   write("a2 := a[7:2] ----> ",imagex(a2 := a[7:2]) | "none")
   write("a3 := a[2+:3] ----> ",imagex(a3 := a[2+:3]) | "none")
   write("a4 := a[-1-:3] ----> ",imagex(a4 := a[-1-:3]) | "none")
   write("a1[1] ----> ",imagex(a1[1]) | "none")
   write("a2[1] ----> ",imagex(a2[1]) | "none")
   write("a3[1] ----> ",imagex(a3[1]) | "none")
end

procedure p9()
   local a5
   write("a4[1] ----> ",imagex(a4[1]) | "none")
   write("a4[1] := a ----> ",imagex(a4[1] := a) | "none")
   write("a := [1,2,3,4] ----> ",imagex(a := [1,2,3,4]) | "none")
   write("a1 := a[1:2] ----> ",imagex(a1 := a[1:2]) | "none")
   write("every write(!a1) ----> ",imagex(every write(!a1)) | "none")
   write("a2 := a[3:0] ----> ",imagex(a2 := a[3:0]) | "none")
   write("every write(!a2) ----> ",imagex(every write(!a2)) | "none")
   write("a4 := a[2:2] ----> ",imagex(a4 := a[2:2]) | "none")
   write("every write(!a4) ----> ",imagex(every write(!a4)) | "none")
   write("a5 := a[0-:2] ----> ",imagex(a5 := a[0-:2]) | "none")
   write("every write(!a5) ----> ",imagex(every write(!a5)) | "none")
end

procedure p10()
   write("a3 := a[0:3] ----> ",imagex(a3 := a[0:3]) | "none")
   write("every write(!a3) ----> ",imagex(every write(!a3)) | "none")
   write("a := \"abcd\" ----> ",imagex(a := "abcd") | "none")
   write("a1 := a[1:2] ----> ",imagex(a1 := a[1:2]) | "none")
   write("every write(!a1) ----> ",imagex(every write(!a1)) | "none")
   write("a2 := a[3:0] ----> ",imagex(a2 := a[3:0]) | "none")
   write("every write(!a2) ----> ",imagex(every write(!a2)) | "none")
   write("a3 := a[0:3] ----> ",imagex(a3 := a[0:3]) | "none")
   write("every write(!a3) ----> ",imagex(every write(!a3)) | "none")
   write("a4 := a[2:2] ----> ",imagex(a4 := a[2:2]) | "none")
   write("every write(!a4) ----> ",imagex(every write(!a4)) | "none")
end

procedure p11()
   local a5
   write("a5 := a[0-:2] ----> ",imagex(a5 := a[0-:2]) | "none")
   write("every write(!a5) ----> ",imagex(every write(!a5)) | "none")
   write("[] ||| [] ----> ",imagex([] ||| []) | "none")
   write("[1,2,3] ||| [] ----> ",imagex([1,2,3] ||| []) | "none")
   write("[] ||| [1,2,3] ----> ",imagex([] ||| [1,2,3]) | "none")
   write("r := array(1,2,3,4,5,6,7,8,9) ----> ",imagex(r := array(1,2,3,4,5,6,7,8,9)) | "none")
   write("r.a ----> ",imagex(r.a) | "none")
   write("r.b ----> ",imagex(r.b) | "none")
   write("r.c ----> ",imagex(r.c) | "none")
   write("r.d ----> ",imagex(r.d) | "none")
   write("r.e ----> ",imagex(r.e) | "none")
end

procedure p12()
   write("r.f ----> ",imagex(r.f) | "none")
   write("type(r) ----> ",imagex(type(r)) | "none")
   write("imagex(r) ----> ",imagex(imagex(r)) | "none")
   write("r.a +:= 0 ----> ",imagex(r.a +:= 0) | "none")
   write("r.b +:= 0 ----> ",imagex(r.b +:= 0) | "none")
   write("r.c +:= 0 ----> ",imagex(r.c +:= 0) | "none")
   write("r.d +:= 0 ----> ",imagex(r.d +:= 0) | "none")
   write("r.e +:= 0 ----> ",imagex(r.e +:= 0) | "none")
   write("r.f +:= 0 ----> ",imagex(r.f +:= 0) | "none")
   write("r.a ----> ",imagex(r.a) | "none")
   write("r.b ----> ",imagex(r.b) | "none")
end

procedure p13()
   write("r.c ----> ",imagex(r.c) | "none")
   write("r.d ----> ",imagex(r.d) | "none")
   write("r.e ----> ",imagex(r.e) | "none")
   write("r.f ----> ",imagex(r.f) | "none")
   write("r := array(\"a\",2,array(),r,main) ----> ",imagex(r := array("a",2,3.5,array(),r,main)) | "none")
   write("every write(imagex(!r)) ----> ",imagex(every write(imagex(!r))) | "none")
   write("r[1] :=: r.d ----> ",imagex(r[1] :=: r.d) | "none")
   write("every write(imagex(!r)) ----> ",imagex(every write(imagex(!r))) | "none")
   # test that overflow is not ignored when comparing integers
   a := [847198497, -2035912587]
   every writes(" ", "a:" | !sort(a) | "\n")
end

procedure main()
   p1()
   p2()
   p3()
   p4()
   p5()
   p6()
   p7()
   p8()
   p9()
   p10()
   p11()
   p12()
   p13()
end

global s, t, x, r
global a, a1, a2, a3, a4
