import gui, graphics, io

class ImageViewTest(Dialog)
   public iv, img
   public component_setup()
      self.setup()
      iv.set_image(img)
   end

   public end_dialog()
      img.close()
   end

   public set_file(f)
      self.img := Window().set_image(f) | stop("Couldn't load image:", &why)
      (\iv).set_image(img)
   end

   public init_dialog()
   end

   public on_quit(ev)
      dispose()
   end

   public new()
      cast(self,Dialog).new()
      return
   end

   private setup()
      local quit, paint
      set_resize(&yes)
      set_size(362, 344)
      iv := ImageView().
         set_pos("50%", "10").
         set_size("100%-20", "100%-60").
         set_align(Align.C, Align.T).
         clear_constraints()
      add(iv)
      paint := TextPaint("Quit")
      quit := TextButton().
         set_pos("50%", "100%-25").
         set_align(Align.C, Align.C).
         clear_constraints().
         set_accel("q").
         connect(on_quit, Event.ACTION).
         set_toggles(&no).
         set_paint(paint)
      add(quit)
   end
end


#
# An example of a custom scroll area which displays an image
# with scrollbars.
#

class ImageView(DrawScrollArea)
   public img

   public draw(r)
      img.copy_to(get_area_x(), get_area_y(), view.w, view.h, 
                  view.cbwin, view.x, view.y)
   end

   public calculate_subject_width()
      return img.get_width()
   end

   public calculate_subject_height()
      return img.get_height()
   end

   public get_default_vertical_increment()
      return 10
   end

   public get_default_horizontal_increment()
      return 10
   end

   public set_image(img)
      self.img := img
      compute_and_invalidate()
   end

   public new()
      cast(self,DrawScrollArea).new()
      use_default_keys()
      return
   end
end



procedure main(a)
   local d, f
   f := a[1] | "babbage.gif"
   d := ImageViewTest()
   d.set_file(f)
   d.show_modal()
end

### Ivib-v2 layout ##
#CCanvas|I18SSuperClass Name|SDialog|SImport Name|Sgui|SButton Groups|L
#0SCheckbox Groups|L0SGen Indent|I3SGen Main|I1SGen Component Setup|I1S
#Gen Init Dialog|I1SGen Constructor|I1SDialog Struct|CCDialog|I1SWAttri
#bs|T1NSresize|I1SName|SImageViewTest|SIs Component|NSWidth|S362|SHeigh
#t|S344|SChildren|L2CCanvasCustom|I27SParent Canvas|X1SName|Siv|SClass 
#Name|SImageView|SImport Name|Sgui|SClass Variable|I1SX Fix|I1SY Fix|I1
#SW Fix|I1SH Fix|I1SX Spec|S50%|SY Spec|S10|SW Spec|S100%-20|SH Spec|S1
#00%-60|SX Align|Sc|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T
#0NSConstraints|T0NSTooltip|NSAccel|NSLayout delegate|NSBorder opts|NSE
#vent Handlers|L0SClass Variable|I1SParent Component|X1CCanvasTextButto
#n|I35SParent Canvas|X1SName|Squit|SClass Name|STextButton|SImport Name
#|Sgui|SClass Variable|NSX Fix|I1SY Fix|I1SW Fix|NSH Fix|NSX Spec|S50%|
#SY Spec|S100%-25|SW Spec|NSH Spec|NSX Align|Sc|SY Align|Sc|SZ|I0STab o
#rd|I0SIs shaded|NSWAttribs|T0NSConstraints|T0NSTooltip|NSAccel|Sq|SLay
#out delegate|NSBorder opts|NSEvent Handlers|L1L2SEvent.ACTION|Son_quit
#|SClass Variable|NSParent Component|X1SNo click focus|NSAccepts focus 
#Flag|I1SIs Checked Flag|NSIs Checkbox Flag|NSParent CheckBoxGroup|NSPa
#rent Button Group|NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Sp
#aint|SClass Name|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|SQ
#uit|SPaint down|NSInitial Focus|NSEvent Handlers|L0SLayout delegate|N
