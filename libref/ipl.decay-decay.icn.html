<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>decay.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#	File:     decay.icn
<a name="4"/>#
<a name="5"/>#	Subject:  Procedures for decaying-displays for windows
<a name="6"/>#
<a name="7"/>#	Author:   Gregg M. Townsend
<a name="8"/>#
<a name="9"/>#	Date:     August 14, 1996
<a name="10"/>#
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/>#	These procedures provide a way to draw objects and then have them
<a name="18"/>#	automatically redrawn (say, in a lighter color) n steps later.
<a name="19"/>#	A user routine is called to do the actual drawing.  If a second
<a name="20"/>#	call to draw an object comes before its time has expired, the
<a name="21"/>#	object's counter is reset and the drawing routine is not called.
<a name="22"/>#
<a name="23"/>#	dpipe() initializes a decay pipeline and returns a pipeline object.
<a name="24"/>#
<a name="25"/>#	decay() marks an object, unmarks another, and advances the clock.
<a name="26"/>#
<a name="27"/>############################################################################
<a name="28"/>#
<a name="29"/>#   dpipe(proc, length, gc1, gc2) -- create a decay pipeline
<a name="30"/>#
<a name="31"/>#	dpipe() initializes a decay pipeline and returns a pipeline object.
<a name="32"/>#
<a name="33"/>#	proc	user marking procedure: proc(gc, i) marks entry i using gc
<a name="34"/>#	length	length of the delay pipeline (number of steps)
<a name="35"/>#	gc1	gc to mark an entry when it becomes active
<a name="36"/>#	gc2	gc to mark an entry when it decays (becomes inactive)
<a name="37"/>#
<a name="38"/>#   decay(dp, i) -- mark entry i with later decay
<a name="39"/>#
<a name="40"/>#	decay() marks an object, unmarks another, and advances the clock.
<a name="41"/>#
<a name="42"/>#	Using decay pipe dp, entry i (anything but &amp;null) is drawn in an
<a name="43"/>#	active state, and the oldest entry in the pipe is drawn in an
<a name="44"/>#	inactive state.
<a name="45"/>#
<a name="46"/>#	Records are kept, though, so that an already-active entry is not
<a name="47"/>#	redrawn, and a decayed entry reaching the end of the pipe is not
<a name="48"/>#	drawn as inactive if it was more recently renewed.
<a name="49"/>#
<a name="50"/>#	The decay pipe can be flushed by a sufficient number of
<a name="51"/>#	decay(dp, &amp;null) calls.
<a name="52"/>#
<a name="53"/>############################################################################
<a name="54"/>#
<a name="55"/>#  Requires:  Version 9 graphics
<a name="56"/>#
<a name="57"/>############################################################################
<a name="58"/>
<a name="59"/>package ipl.decay
<a name="60"/>
<a name="61"/>record Decay_Rec(	# decay pipe record
<a name="62"/>   pipe,	# queue of active indices
<a name="63"/>   tab,		# table of activity for each index
<a name="64"/>   proc,	# marking procedure
<a name="65"/>   gc1,		# gc to use to turn on
<a name="66"/>   gc2)		# gc to use to turn off
<a name="67"/>
<a name="68"/>
<a name="69"/>##  dpipe(proc, length, gc1, gc2) -- create a decay pipeline
<a name="70"/>
<a name="71"/># create a decay pipeline
<a name="72"/>procedure dpipe(proc, length, gc1, gc2)		
<a name="73"/>   return Decay_Rec(list(length), table(0), proc, gc1, gc2)
<a name="74"/>end
<a name="75"/>
<a name="76"/>
<a name="77"/>##  decay(dp, i) -- mark entry i with later decay
<a name="78"/>
<a name="79"/># mark entry for later decay
<a name="80"/>procedure decay(dp, i)				
<a name="81"/>   local j
<a name="82"/>   j := get(dp.pipe)
<a name="83"/>   if (dp.tab[\i] +:= 1) = 1 then
<a name="84"/>      dp.proc(dp.gc1, i)
<a name="85"/>   if (dp.tab[\j] -:= 1) = 0 then
<a name="86"/>      dp.proc(dp.gc2, j)
<a name="87"/>   put(dp.pipe, i)
<a name="88"/>end
</pre></body></html>
