<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>completefield.icn</title></head><body><pre>
<a name="1"/>package gui
<a name="2"/>
<a name="3"/>import ipl.strings, lang, util
<a name="4"/>
<a name="5"/># This type gives, for each displayed suggestion, the label to display
<a name="6"/># in the popup and the string to set in the field on selection, and
<a name="7"/># the cursor position to go to.
<a name="8"/>#
<a name="9"/>class CompleteElement(Conversion)
<a name="10"/>   public const
<a name="11"/>      label
<a name="12"/>
<a name="13"/>   public override new(label, str, pos)
<a name="14"/>      self.label := need_text(label)
<a name="15"/>      Conversion.new(str, pos)
<a name="16"/>      return
<a name="17"/>   end
<a name="18"/>end
<a name="19"/>
<a name="20"/># A useful sort comparator for `CompleteElement` instances.
<a name="21"/>#
<a name="22"/>procedure cmp_CompleteElement(x, y)
<a name="23"/>   return Text.consistent_compare(x.label, y.label)
<a name="24"/>end
<a name="25"/>
<a name="26"/># This class is a `TextField` which provides suggested insertion text when
<a name="27"/># tab is pressed.
<a name="28"/>#
<a name="29"/># `do_request` should return a list of `CompleteElement` records.
<a name="30"/>#
<a name="31"/>abstract class CompleteField(SuggestField)
<a name="32"/>   private static label_field(x)
<a name="33"/>      return x.label
<a name="34"/>   end
<a name="35"/>
<a name="36"/>   public override create_popup()
<a name="37"/>      return ItemPaintList().
<a name="38"/>         set_item_paint(MapItemPaint(TextItemPaint(), label_field)).
<a name="39"/>         set_item_border(EmptyBorder().
<a name="40"/>                             set_insets(Gui.TEXT_INSET, Gui.TEXT_INSET, 0, 0).
<a name="41"/>                             set_x_align(Align.L))
<a name="42"/>   end
<a name="43"/>
<a name="44"/>   public override convert_element(o)
<a name="45"/>      return o
<a name="46"/>   end
<a name="47"/>
<a name="48"/>   public override get_insertion(l)
<a name="49"/>      local e, t, s
<a name="50"/>      t := []
<a name="51"/>      every e := !l do {
<a name="52"/>         (contents[1:cursor] == e.str[1:cursor] &amp;
<a name="53"/>          contents[cursor:0] == e.str[e.pos:0]) | fail
<a name="54"/>         put(t, e.str[cursor:e.pos])
<a name="55"/>      }
<a name="56"/>      if s := ("" ~== coprefix(t)) then
<a name="57"/>         return Conversion(contents[1:cursor] || s || contents[cursor:0], cursor + *s)
<a name="58"/>   end
<a name="59"/>
<a name="60"/>   public override new()
<a name="61"/>      SuggestField.new()
<a name="62"/>      set_popup_on_tab(&amp;yes)
<a name="63"/>      return
<a name="64"/>   end
<a name="65"/>end
</pre></body></html>
