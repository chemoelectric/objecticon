<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>overlayset.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: overlayset.icn 8468 2020-09-06 17:24:16Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>import util, ipl.pdco
<a name="12"/>
<a name="13"/>#
<a name="14"/># This class provides a container which contains several `OverlayItems`, only one
<a name="15"/># of which is visible at a time.
<a name="16"/>#
<a name="17"/>class OverlaySet(Component)
<a name="18"/>   public 
<a name="19"/>      remember_focus_flag,
<a name="20"/>      which_one
<a name="21"/>
<a name="22"/>   #
<a name="23"/>   # If set, then a item remembers if it had focus when it was
<a name="24"/>   # deselected, and restores it when it is reselected.
<a name="25"/>   #
<a name="26"/>   public set_remember_focus(s)
<a name="27"/>      self.remember_focus_flag := need_flag(s)
<a name="28"/>      link
<a name="29"/>   end
<a name="30"/>
<a name="31"/>   public override display()
<a name="32"/>      #
<a name="33"/>      # Display contents of current tab into buffer
<a name="34"/>      #
<a name="35"/>      display_child(which_one)
<a name="36"/>   end
<a name="37"/>
<a name="38"/>   public maybe_remember_focus()
<a name="39"/>      local f
<a name="40"/>      \remember_focus_flag | fail
<a name="41"/>      which_one.remembered_focus := &amp;null
<a name="42"/>      f := parent_dialog.get_focus() | fail
<a name="43"/>      if f.gen_parents() === which_one then
<a name="44"/>         which_one.remembered_focus := f
<a name="45"/>   end
<a name="46"/>
<a name="47"/>   public maybe_restore_focus()
<a name="48"/>      local f
<a name="49"/>      \remember_focus_flag | fail
<a name="50"/>      f := \which_one.remembered_focus | fail
<a name="51"/>      if f.is_live() then
<a name="52"/>         f.grab_focus()
<a name="53"/>   end
<a name="54"/>
<a name="55"/>   #
<a name="56"/>   # Set which OverlayItem is currently displayed.  The default is
<a name="57"/>   # the first which was added.
<a name="58"/>   # :Parameters :
<a name="59"/>   # :  `dont_restore_flag` - if set, then the item's remembered focus will not be
<a name="60"/>   #         restored (only relevant if remember_focus is on).
<a name="61"/>   #
<a name="62"/>   public set_which_one(x, dont_restore_flag)
<a name="63"/>      if which_one === x then
<a name="64"/>         link
<a name="65"/>      if is_initialized() then {
<a name="66"/>         maybe_remember_focus()
<a name="67"/>         which_one := x
<a name="68"/>         set_hidden_flags()
<a name="69"/>         if /dont_restore_flag then
<a name="70"/>            maybe_restore_focus()
<a name="71"/>         invalidate()
<a name="72"/>      } else
<a name="73"/>         which_one := x
<a name="74"/>      link
<a name="75"/>   end
<a name="76"/>
<a name="77"/>   public set_hidden_flags()
<a name="78"/>      local c
<a name="79"/>      every c := !self.children do {
<a name="80"/>         if c === self.which_one then
<a name="81"/>            c.set_is_hidden(&amp;no)
<a name="82"/>         else
<a name="83"/>            c.set_is_hidden(&amp;yes)
<a name="84"/>      }
<a name="85"/>      link
<a name="86"/>   end
<a name="87"/>
<a name="88"/>   public override initially()
<a name="89"/>      if *self.children = 0 then
<a name="90"/>         runerr("No OverlayItems in OverlaySet")
<a name="91"/>      /self.which_one := self.children[1]
<a name="92"/>      set_hidden_flags()
<a name="93"/>      Component.initially()
<a name="94"/>   end
<a name="95"/>
<a name="96"/>   public override get_default_width()
<a name="97"/>      return MaxNN{ (!children).get_preferred_width() }
<a name="98"/>   end
<a name="99"/>
<a name="100"/>   public override get_default_height(dw)
<a name="101"/>      return MaxNN{ (!children).get_preferred_height(dw) }
<a name="102"/>   end
<a name="103"/>
<a name="104"/>   public override layout()
<a name="105"/>      local c
<a name="106"/>      every c := !self.children do {
<a name="107"/>         c.x := self.x
<a name="108"/>         c.y := self.y
<a name="109"/>         c.w := self.w
<a name="110"/>         c.h := self.h
<a name="111"/>         c.layout()
<a name="112"/>      }
<a name="113"/>   end
<a name="114"/>
<a name="115"/>   #
<a name="116"/>   # Return the currently selected item
<a name="117"/>   #
<a name="118"/>   public get_which_one()
<a name="119"/>      return self.which_one
<a name="120"/>   end
<a name="121"/>
<a name="122"/>   public override new()
<a name="123"/>      Component.new()
<a name="124"/>      self.set_constraint("x_fill", &amp;yes)
<a name="125"/>      self.set_constraint("y_fill", &amp;yes)
<a name="126"/>      self.set_constraint("x_weight", 1.0)
<a name="127"/>      self.set_constraint("y_weight",  1.0)
<a name="128"/>      return
<a name="129"/>   end
<a name="130"/>end
<a name="131"/>
</pre></body></html>
