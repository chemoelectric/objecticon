<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>texthandler.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: texthandler.icn 8996 2021-03-24 07:27:53Z rparlett $
<a name="3"/>#
<a name="4"/>
<a name="5"/>package mail
<a name="6"/>
<a name="7"/>import util, lang, ipl.strings, ipl.pdco
<a name="8"/>
<a name="9"/>class TextHandler(TypeHandler)
<a name="10"/>   public override can_handle(ct)
<a name="11"/>      succeed Text.lower(ct.get_type()) == "text"
<a name="12"/>   end
<a name="13"/>   
<a name="14"/>   public override convert_to_object(m, data)
<a name="15"/>      local res
<a name="16"/>
<a name="17"/>      #
<a name="18"/>      # Convert line endings to local form
<a name="19"/>      #
<a name="20"/>      res := String{ separate_lines(data), "\N" }
<a name="21"/>
<a name="22"/>      if Text.lower(m.get_content_type().get_parameter("charset")) == "utf-8" then
<a name="23"/>         res := ucs(res) | return error("TextHandler: raw data not in UTF-8 format")
<a name="24"/>
<a name="25"/>      return res
<a name="26"/>   end
<a name="27"/>
<a name="28"/>   public override convert_from_object(m, obj)
<a name="29"/>      local res
<a name="30"/>
<a name="31"/>      obj := string(obj) | return error("TextHandler: Couldn't convert object to string: " || image(obj))
<a name="32"/>
<a name="33"/>      #
<a name="34"/>      # Convert line endings to canonical form (CRLF)
<a name="35"/>      #
<a name="36"/>      res := String{ separate_lines(obj), "\r\n" }
<a name="37"/>
<a name="38"/>      return res
<a name="39"/>   end
<a name="40"/>end
</pre></body></html>
