<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>httprequest.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: httprequest.icn 8058 2019-12-13 16:36:45Z rparlett $
<a name="3"/>#
<a name="4"/>
<a name="5"/>package http
<a name="6"/>
<a name="7"/>import util, net, io, mail
<a name="8"/>
<a name="9"/>#
<a name="10"/># Encapsulate one request to `HttpClient`.
<a name="11"/>#
<a name="12"/>class HttpRequest(MimeHeaders)
<a name="13"/>   private readable 
<a name="14"/>      url,
<a name="15"/>      input_stream,
<a name="16"/>      method,
<a name="17"/>      output_stream,
<a name="18"/>      referer,
<a name="19"/>      range_start,
<a name="20"/>      range_end,
<a name="21"/>      content_type,
<a name="22"/>      helper
<a name="23"/>
<a name="24"/>   #
<a name="25"/>   # Set the desired url.
<a name="26"/>   #
<a name="27"/>   public set_url(url)
<a name="28"/>      self.url := need_URL(url)
<a name="29"/>      link
<a name="30"/>   end
<a name="31"/>
<a name="32"/>   #
<a name="33"/>   # Set the range of data to get; either being &amp;null implies the
<a name="34"/>   # start or end of data respectively.
<a name="35"/>   #
<a name="36"/>   public set_range(s, e)
<a name="37"/>      self.range_start := /s | need_integer(s, 0)
<a name="38"/>      self.range_end := /e | need_integer(e, 0)
<a name="39"/>      link
<a name="40"/>   end
<a name="41"/>
<a name="42"/>   #
<a name="43"/>   # Convenience method to set the post data from a table
<a name="44"/>   # which represents html form post data.  The content type
<a name="45"/>   # is set appropriately too.
<a name="46"/>   #
<a name="47"/>   public set_html_form_data(t)
<a name="48"/>      set_input_stream(StringStream(URL.make_cgi_string(t)))
<a name="49"/>      set_method("POST")
<a name="50"/>      set_content_type("application/x-www-form-urlencoded")
<a name="51"/>      link
<a name="52"/>   end
<a name="53"/>
<a name="54"/>   #
<a name="55"/>   # Convenience method to set the post data from a Message
<a name="56"/>   # which represents html form post data.  The content type
<a name="57"/>   # is set appropriately too.
<a name="58"/>   #
<a name="59"/>   # The Message object must have content type multipart/form-data,
<a name="60"/>   # and have an appropriate MultiPart set as its content object.
<a name="61"/>   #
<a name="62"/>   public set_multipart_form_data(m)
<a name="63"/>      local s
<a name="64"/>      s := m.to_rfc822()
<a name="65"/>      # Strip off everything up to first boundary.
<a name="66"/>      s ?:= (tab(find("--boundary")), tab(0))
<a name="67"/>      set_input_stream(StringStream(s))
<a name="68"/>      set_method("POST")
<a name="69"/>      set_content_type(m.get_first_header("Content-Type"))
<a name="70"/>      link
<a name="71"/>   end
<a name="72"/>
<a name="73"/>   #
<a name="74"/>   # Set the content type of the post/put data.  The parameter may
<a name="75"/>   # either be a string, or a `ContentType` instance.  In the latter
<a name="76"/>   # case, it is converted to string using `ContentType.to_rfc2616()`.
<a name="77"/>   #
<a name="78"/>   public set_content_type(content_type)
<a name="79"/>      if is(content_type, ContentType) then
<a name="80"/>         content_type := content_type.to_rfc2616()
<a name="81"/>      self.content_type := content_type
<a name="82"/>      link
<a name="83"/>   end
<a name="84"/>
<a name="85"/>   #
<a name="86"/>   # Set the request method type.  The default is `GET`, unless post data is set, in which
<a name="87"/>   # case the default is `POST`.
<a name="88"/>   #
<a name="89"/>   public set_method(method)
<a name="90"/>      self.method := need_string(method)
<a name="91"/>      link
<a name="92"/>   end
<a name="93"/>
<a name="94"/>   #
<a name="95"/>   # Set the referer page; the value may be a string or a `URL`.
<a name="96"/>   #
<a name="97"/>   public set_referer(s)
<a name="98"/>      self.referer := s
<a name="99"/>      link
<a name="100"/>   end
<a name="101"/>
<a name="102"/>   #
<a name="103"/>   # For a POST or PUT, set the stream to read data from.
<a name="104"/>   #
<a name="105"/>   public set_input_stream(f)
<a name="106"/>      self.input_stream := f
<a name="107"/>      link
<a name="108"/>   end
<a name="109"/>
<a name="110"/>   #
<a name="111"/>   # Set a stream to use to receive the data; always required except
<a name="112"/>   # on a "HEAD" method.
<a name="113"/>   #
<a name="114"/>   public set_output_stream(f)
<a name="115"/>      self.output_stream := f
<a name="116"/>      link
<a name="117"/>   end
<a name="118"/>
<a name="119"/>   #
<a name="120"/>   # Set an instance of `HttpRequestHelper` to provide extra functions
<a name="121"/>   # which can be called during the request.
<a name="122"/>   #
<a name="123"/>   public set_helper(x)
<a name="124"/>      self.helper := x
<a name="125"/>      link
<a name="126"/>   end
<a name="127"/>
<a name="128"/>   public override new()
<a name="129"/>      MimeHeaders.new()
<a name="130"/>      method := "GET"
<a name="131"/>      return
<a name="132"/>   end
<a name="133"/>end
</pre></body></html>
