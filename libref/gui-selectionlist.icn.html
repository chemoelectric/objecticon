<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>selectionlist.icn</title></head><body><pre>
<a name="1"/>package gui
<a name="2"/>
<a name="3"/>import
<a name="4"/>   util,
<a name="5"/>   ipl.numbers
<a name="6"/>
<a name="7"/>abstract class SelectionList()
<a name="8"/>   public 
<a name="9"/>      selection,
<a name="10"/>      selection_list
<a name="11"/>
<a name="12"/>   #
<a name="13"/>   # Set the list selection items to the list x.
<a name="14"/>   # :Parameters :
<a name="15"/>   # :  `x` - The list of items
<a name="16"/>   #
<a name="17"/>   public set_selection_list(x)
<a name="18"/>      self.selection_list := need_list(x)
<a name="19"/>      /self.selection := 1
<a name="20"/>      constrain_selection()
<a name="21"/>      apply_selection()
<a name="22"/>      link
<a name="23"/>   end
<a name="24"/>
<a name="25"/>   #
<a name="26"/>   # Set the selected item.
<a name="27"/>   # :Parameters :
<a name="28"/>   # :  `x` - An index into the list of selectable items.
<a name="29"/>   #
<a name="30"/>   public set_selection(x, ev)
<a name="31"/>      self.selection := /x | need_integer(x)
<a name="32"/>      constrain_selection()
<a name="33"/>      apply_selection(ev)
<a name="34"/>      link
<a name="35"/>   end
<a name="36"/>
<a name="37"/>   #
<a name="38"/>   # Keep the selection within the bounds of the contents.
<a name="39"/>   #
<a name="40"/>   public constrain_selection()
<a name="41"/>      if *self.selection_list = 0 then
<a name="42"/>         self.selection := &amp;null
<a name="43"/>      else if \self.selection then {
<a name="44"/>         self.selection &lt;:= 1
<a name="45"/>         self.selection &gt;:= *self.selection_list
<a name="46"/>      }
<a name="47"/>      link
<a name="48"/>   end
<a name="49"/>
<a name="50"/>   #
<a name="51"/>   # Return an integer corresponding to the item in the list
<a name="52"/>   # presently selected.
<a name="53"/>   #
<a name="54"/>   public get_selection()
<a name="55"/>      return \self.selection
<a name="56"/>   end
<a name="57"/>
<a name="58"/>   #
<a name="59"/>   # Convenient method to get the item in the selection list currently selected.
<a name="60"/>   #
<a name="61"/>   public object_get_selection()
<a name="62"/>      return self.selection_list[\self.selection]
<a name="63"/>   end
<a name="64"/>
<a name="65"/>   #
<a name="66"/>   # Convenient method to set the selection to the given object.  Fails
<a name="67"/>   # if the item is not in the list, returns the index selected otherwise.
<a name="68"/>   #
<a name="69"/>   public object_set_selection(o)
<a name="70"/>      local i
<a name="71"/>      if i := keyof(selection_list, o) then {
<a name="72"/>         set_selection(i)
<a name="73"/>         return i
<a name="74"/>      }
<a name="75"/>   end
<a name="76"/>
<a name="77"/>   #
<a name="78"/>   # Set the selection list, and constrain the selection, but do not
<a name="79"/>   # synchronize by calling `apply_selection`.
<a name="80"/>   #
<a name="81"/>   # :Parameters :
<a name="82"/>   # :  `x` - The list of items
<a name="83"/>   #
<a name="84"/>   public set_selection_list_only(x)
<a name="85"/>      self.selection_list := need_list(x)
<a name="86"/>      constrain_selection()
<a name="87"/>      link
<a name="88"/>   end
<a name="89"/>
<a name="90"/>   #
<a name="91"/>   # Set the selected item, and constrain that selection, but do not
<a name="92"/>   # synchronize by calling `apply_selection`.
<a name="93"/>   #
<a name="94"/>   # :Parameters :
<a name="95"/>   # :  `x` - An index into the list of selectable items.
<a name="96"/>   #
<a name="97"/>   public set_selection_only(x)
<a name="98"/>      self.selection := /x | need_integer(x)
<a name="99"/>      constrain_selection()
<a name="100"/>      link
<a name="101"/>   end
<a name="102"/>
<a name="103"/>   #
<a name="104"/>   # Helper function to increment the selection.  If the selection
<a name="105"/>   # list is empty, it does nothing and fails; otherwise the selection
<a name="106"/>   # is incremented, wrapping around at the end of the selection list.
<a name="107"/>   #
<a name="108"/>   public increment_selection(ev)
<a name="109"/>      if *selection_list = 0 then
<a name="110"/>         fail
<a name="111"/>      set_selection(if /selection then 1
<a name="112"/>                    else mod1(selection + 1, *selection_list), ev)
<a name="113"/>      link
<a name="114"/>   end
<a name="115"/>
<a name="116"/>   #
<a name="117"/>   # Helper function to decrement the selection.  If the selection
<a name="118"/>   # list is empty, it does nothing and fails; otherwise the selection
<a name="119"/>   # is decremented, wrapping around at the start of the selection list.
<a name="120"/>   #
<a name="121"/>   public decrement_selection(ev)
<a name="122"/>      if *selection_list = 0 then
<a name="123"/>         fail
<a name="124"/>      set_selection(if /selection then *selection_list
<a name="125"/>                    else mod1(selection - 1, *selection_list), ev)
<a name="126"/>      link
<a name="127"/>   end
<a name="128"/>
<a name="129"/>   public abstract apply_selection(ev)
<a name="130"/>end
</pre></body></html>
