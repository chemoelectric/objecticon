<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>spin.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: spin.icn 7872 2019-08-21 13:29:37Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>import graphics
<a name="12"/>
<a name="13"/>#
<a name="14"/># This class is the base class for all spin components.  It just provides the up/down
<a name="15"/># buttons and two abstract methods which are invoked to implement those actions.
<a name="16"/>#
<a name="17"/>abstract class Spin(Component, HasUseWheel)
<a name="18"/>   public 
<a name="19"/>      up, 
<a name="20"/>      down,
<a name="21"/>      view
<a name="22"/>
<a name="23"/>   #
<a name="24"/>   # This method must be overridden to do something to the component when the
<a name="25"/>   # up button is pressed.
<a name="26"/>   #
<a name="27"/>   public abstract do_increment(ev)
<a name="28"/>
<a name="29"/>   #
<a name="30"/>   # This method must be overridden to do something to the component when the
<a name="31"/>   # down button is pressed.
<a name="32"/>   #
<a name="33"/>   public abstract do_decrement(ev)
<a name="34"/>
<a name="35"/>   #
<a name="36"/>   # Create the view component
<a name="37"/>   #
<a name="38"/>   public abstract create_view()
<a name="39"/>
<a name="40"/>   #
<a name="41"/>   # This may be overridden to monitor for changes to trigger events.  It is
<a name="42"/>   # invoked before the do_increment/do_decrement methods are called
<a name="43"/>   #
<a name="44"/>   public start_change(e)
<a name="45"/>   end
<a name="46"/>
<a name="47"/>   #
<a name="48"/>   # This may be overridden to monitor for changes to trigger events.  It is
<a name="49"/>   # invoked after the do_increment/do_decrement methods are called
<a name="50"/>   #
<a name="51"/>   public end_change(e)
<a name="52"/>   end
<a name="53"/>
<a name="54"/>   public on_up(ev)
<a name="55"/>      go_up(ev)
<a name="56"/>   end
<a name="57"/>
<a name="58"/>   public on_down(ev)
<a name="59"/>      go_down(ev)
<a name="60"/>   end
<a name="61"/>
<a name="62"/>   public override display()
<a name="63"/>      border.draw_rect(self.cbwin, self)
<a name="64"/>      display_children()
<a name="65"/>   end
<a name="66"/>
<a name="67"/>   public override focus_changed(e) 
<a name="68"/>      view.invalidate()
<a name="69"/>   end
<a name="70"/>
<a name="71"/>   public override get_default_width()
<a name="72"/>      return border.get_total_width() + up.get_preferred_width() + view.get_preferred_width()
<a name="73"/>   end
<a name="74"/>
<a name="75"/>   public override get_default_height(dw)
<a name="76"/>      dw -:= border.get_total_width() + up.get_preferred_width()
<a name="77"/>      return border.get_total_height() + view.get_preferred_height(dw)
<a name="78"/>   end
<a name="79"/>
<a name="80"/>   public override layout()
<a name="81"/>      local bh, bw
<a name="82"/>      bw := up.get_preferred_width()
<a name="83"/>      bh := (self.h - border.get_total_height()) / 2
<a name="84"/>      down.x := up.x := self.x + self.w - border.get_r_inset() - bw
<a name="85"/>      view.y := up.y := self.y + border.get_t_inset()
<a name="86"/>      down.y := up.y + bh
<a name="87"/>      down.w := up.w := bw
<a name="88"/>      up.h := bh
<a name="89"/>      down.h := self.h - border.get_total_height() - up.h
<a name="90"/>      view.x := self.x + border.get_l_inset()
<a name="91"/>      view.w := self.w - border.get_total_width() - bw
<a name="92"/>      view.h := self.h - border.get_total_height()
<a name="93"/>      up.layout()
<a name="94"/>      down.layout()
<a name="95"/>      view.layout()
<a name="96"/>   end
<a name="97"/>
<a name="98"/>   public go_up(e)
<a name="99"/>      start_change(e)
<a name="100"/>      do_increment(e)
<a name="101"/>      end_change(e)
<a name="102"/>   end
<a name="103"/>
<a name="104"/>   public go_down(e)
<a name="105"/>      start_change(e)
<a name="106"/>      do_decrement(e)
<a name="107"/>      end_change(e)
<a name="108"/>   end
<a name="109"/>
<a name="110"/>   public override handle_wheel_up(e)
<a name="111"/>      go_up(e)
<a name="112"/>   end
<a name="113"/>
<a name="114"/>   public override handle_wheel_down(e)
<a name="115"/>      go_down(e)
<a name="116"/>   end
<a name="117"/>
<a name="118"/>   public override new()
<a name="119"/>      Component.new()
<a name="120"/>      self.set_border(SunkenBorder())
<a name="121"/>      self.up := IconButton().
<a name="122"/>         set_width(ScrollArea.SCROLLBAR_SIZE).  # Consistent with DropDown
<a name="123"/>         connect(self.on_up, Event.BUTTON_PRESS).
<a name="124"/>         connect(self.on_up, Event.BUTTON_HELD).
<a name="125"/>         set_paint(ImagePaint().set_cache("gui.TINY_ARROW_UP")).
<a name="126"/>         set_accepts_focus(&amp;no)
<a name="127"/>      self.add(up)
<a name="128"/>      self.down := IconButton().
<a name="129"/>         set_width(ScrollArea.SCROLLBAR_SIZE).
<a name="130"/>         connect(self.on_down, Event.BUTTON_PRESS).
<a name="131"/>         connect(self.on_down, Event.BUTTON_HELD).
<a name="132"/>         set_paint(ImagePaint().set_cache("gui.TINY_ARROW_DOWN")).
<a name="133"/>         set_accepts_focus(&amp;no)
<a name="134"/>      self.add(down)
<a name="135"/>      self.preferred_focus := self.view := create_view()
<a name="136"/>      self.add(view)
<a name="137"/>      self.set_constraint("x_fill", &amp;yes)
<a name="138"/>      self.set_constraint("x_align", Align.L)
<a name="139"/>      self.set_constraint("x_weight", 1.0)
<a name="140"/>      set_use_wheel(&amp;yes)
<a name="141"/>      return
<a name="142"/>   end
<a name="143"/>end
<a name="144"/>
<a name="145"/>
<a name="146"/>#
<a name="147"/># Selection from a list
<a name="148"/>#
<a name="149"/>abstract class SelectionSpin(SelectionList, Spin)
<a name="150"/>   public convert_element(o)
<a name="151"/>      return text(o)
<a name="152"/>   end
<a name="153"/>
<a name="154"/>   public override do_increment(e)
<a name="155"/>      increment_selection(e)
<a name="156"/>   end
<a name="157"/>
<a name="158"/>   public override do_decrement(e)
<a name="159"/>      decrement_selection(e)
<a name="160"/>   end
<a name="161"/>
<a name="162"/>   public go_to(x, e)
<a name="163"/>      start_change(e)
<a name="164"/>      set_selection(x, e)
<a name="165"/>      end_change(e)
<a name="166"/>   end
<a name="167"/>
<a name="168"/>   public override initially()
<a name="169"/>      \self.selection_list | runerr("No selection list specified")
<a name="170"/>      Spin.initially()
<a name="171"/>   end
<a name="172"/>end
<a name="173"/>
<a name="174"/>
<a name="175"/>class SpinTextField(TextField)
<a name="176"/>   public override keeps(e)
<a name="177"/>      succeed member(Key.CURSOR, e.code)
<a name="178"/>   end
<a name="179"/>
<a name="180"/>   public on_key(e)
<a name="181"/>      case e.code of {
<a name="182"/>         Key.UP : parent.go_up(e)
<a name="183"/>         Key.DOWN : parent.go_down(e)
<a name="184"/>      }
<a name="185"/>   end
<a name="186"/>
<a name="187"/>   public override new()
<a name="188"/>      TextField.new()
<a name="189"/>      self.connect(self.on_key, Event.KEY_PRESS)
<a name="190"/>      self.set_border(EmptyBorder().set_l_inset(Gui.TEXT_INSET).set_r_inset(Gui.TEXT_INSET))
<a name="191"/>      return
<a name="192"/>   end
<a name="193"/>end
<a name="194"/>
<a name="195"/>
<a name="196"/>class SpinLabel(Label)
<a name="197"/>   public override keeps(e)
<a name="198"/>      succeed member(Key.CURSOR_V, e.code)
<a name="199"/>   end
<a name="200"/>
<a name="201"/>   public on_key(e)
<a name="202"/>      case e.code of {
<a name="203"/>         Key.UP : parent.go_up(e)
<a name="204"/>         Key.DOWN : parent.go_down(e)
<a name="205"/>         Key.HOME : if is(parent, SelectionSpin) then
<a name="206"/>                       parent.go_to(1, e)
<a name="207"/>         Key.END : if is(parent, SelectionSpin) then
<a name="208"/>                      parent.go_to(*parent.selection_list, e)
<a name="209"/>      }
<a name="210"/>   end
<a name="211"/>
<a name="212"/>   public override new()
<a name="213"/>      Label.new()
<a name="214"/>      self.set_label("")
<a name="215"/>      self.connect(self.on_key, Event.KEY_PRESS)
<a name="216"/>      self.set_accepts_focus(&amp;yes)
<a name="217"/>      # Align with the text in the textlist.
<a name="218"/>      self.set_border(EmptyBorder().
<a name="219"/>                      set_x_align(Align.L).
<a name="220"/>                      set_l_inset(Gui.TEXT_INSET).
<a name="221"/>                      set_r_inset(Gui.TEXT_INSET))
<a name="222"/>      return
<a name="223"/>   end
<a name="224"/>end
</pre></body></html>
