<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>patterns.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#	File:     patterns.icn
<a name="4"/>#
<a name="5"/>#	Subject:  Procedures for SNOBOL4-style pattern matching
<a name="6"/>#
<a name="7"/>#	Author:   Ralph E. Griswold
<a name="8"/>#
<a name="9"/>#	Date:     June 10, 1988
<a name="10"/>#
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#  
<a name="17"/>#  These procedures provide procedural equivalents for most SNOBOL4
<a name="18"/>#  patterns and some extensions. 
<a name="19"/>#
<a name="20"/>#  Procedures and their pattern equivalents are:
<a name="21"/>#  
<a name="22"/>#       Any(s)         ANY(S)
<a name="23"/>#  
<a name="24"/>#       Arb()          ARB
<a name="25"/>#  
<a name="26"/>#       Arbno(p)       ARBNO(P)
<a name="27"/>#  
<a name="28"/>#       Arbx(i)        ARB(I)
<a name="29"/>#  
<a name="30"/>#       Bal()          BAL
<a name="31"/>#  
<a name="32"/>#       Break(s)       BREAK(S)
<a name="33"/>#  
<a name="34"/>#       Breakx(s)      BREAKX(S)
<a name="35"/>#  
<a name="36"/>#       Cat(p1,p2)     P1 P2
<a name="37"/>#  
<a name="38"/>#       Discard(p)     /P
<a name="39"/>#  
<a name="40"/>#       Exog(s)        \S
<a name="41"/>#  
<a name="42"/>#       Find(s)        FIND(S)
<a name="43"/>#  
<a name="44"/>#       Len(i)         LEN(I)
<a name="45"/>#  
<a name="46"/>#       Limit(p,i)     P \ i
<a name="47"/>#  
<a name="48"/>#       Locate(p)      LOCATE(P)
<a name="49"/>#  
<a name="50"/>#       Marb()         longest-first ARB
<a name="51"/>#  
<a name="52"/>#       Notany(s)      NOTANY(S)
<a name="53"/>#  
<a name="54"/>#       Pos(i)         POS(I)
<a name="55"/>#  
<a name="56"/>#       Replace(p,s)   P = S
<a name="57"/>#  
<a name="58"/>#       Rpos(i)        RPOS(I)
<a name="59"/>#  
<a name="60"/>#       Rtab(i)        RTAB(I)
<a name="61"/>#  
<a name="62"/>#       Span(s)        SPAN(S)
<a name="63"/>#  
<a name="64"/>#       String(s)      S
<a name="65"/>#  
<a name="66"/>#       Succeed()      SUCCEED
<a name="67"/>#  
<a name="68"/>#       Tab(i)         TAB(I)
<a name="69"/>#  
<a name="70"/>#       Xform(f,p)     F(P)
<a name="71"/>#  
<a name="72"/>#     The following procedures relate to the application and control
<a name="73"/>#  of pattern matching:
<a name="74"/>#  
<a name="75"/>#       Apply(s,p)     S ? P
<a name="76"/>#  
<a name="77"/>#       Mode()         anchored or unanchored matching (see Anchor
<a name="78"/>#                      and Float)
<a name="79"/>#  
<a name="80"/>#       Anchor()       &amp;ANCHOR = 1  if Mode := Anchor
<a name="81"/>#  
<a name="82"/>#       Float()        &amp;ANCHOR = 0  if Mode := Float
<a name="83"/>#  
<a name="84"/>#  In addition to the procedures above, the following expressions
<a name="85"/>#  can be used:
<a name="86"/>#  
<a name="87"/>#       p1() | p2()    P1 | P2
<a name="88"/>#  
<a name="89"/>#       v &lt;- p()       P . V  (approximate)
<a name="90"/>#  
<a name="91"/>#       v := p()       P $ V  (approximate)
<a name="92"/>#  
<a name="93"/>#       fail           FAIL
<a name="94"/>#  
<a name="95"/>#       =s             S  (in place of String(s))
<a name="96"/>#  
<a name="97"/>#       p1() || p2()   P1 P2  (in place of Cat(p1,p2))
<a name="98"/>#  
<a name="99"/>#  Using this system, most SNOBOL4 patterns can be satisfactorily
<a name="100"/>#  transliterated into Icon procedures and expressions. For example,
<a name="101"/>#  the pattern
<a name="102"/>#  
<a name="103"/>#          SPAN("0123456789") $ N "H" LEN(*N) $ LIT
<a name="104"/>#  
<a name="105"/>#  can be transliterated into
<a name="106"/>#  
<a name="107"/>#          (n &lt;- Span('0123456789')) || ="H" ||
<a name="108"/>#             (lit &lt;- Len(n))
<a name="109"/>#  
<a name="110"/>#  Concatenation of components is necessary to preserve the
<a name="111"/>#  pattern-matching properties of SNOBOL4.
<a name="112"/>#  
<a name="113"/>#  Caveats: Simulating SNOBOL4 pattern matching using the procedures
<a name="114"/>#  above is inefficient.
<a name="115"/>#  
<a name="116"/>############################################################################
<a name="117"/>
<a name="118"/>package ipl.patterns
<a name="119"/>
<a name="120"/>global Mode, Float
<a name="121"/>
<a name="122"/># &amp;ANCHOR = 1
<a name="123"/>procedure Anchor()			
<a name="124"/>   suspend ""
<a name="125"/>end
<a name="126"/>
<a name="127"/># ANY(S)
<a name="128"/>procedure Any(s)			
<a name="129"/>   suspend tab(any(s))
<a name="130"/>end
<a name="131"/>
<a name="132"/># S ? P
<a name="133"/>procedure Apply(s,p)			
<a name="134"/>   local tsubject, tpos, value
<a name="135"/>   initial {
<a name="136"/>      Float := Arb
<a name="137"/>      /Mode := Float			#  &amp;ANCHOR = 0 if not already set
<a name="138"/>      }
<a name="139"/>   suspend (
<a name="140"/>      (tsubject := &amp;subject) &amp;
<a name="141"/>      (tpos := &amp;pos) &amp;
<a name="142"/>      (&amp;subject &lt;- s) &amp;
<a name="143"/>      (&amp;pos &lt;- 1) &amp;
<a name="144"/>      (Mode() &amp; (value := p())) &amp;
<a name="145"/>      (&amp;pos &lt;- tpos) &amp;			# to restore on backtracking
<a name="146"/>      (&amp;subject &lt;- tsubject) &amp;		# note this sets &amp;pos
<a name="147"/>      (&amp;pos &lt;- tpos) &amp;			# to restore on evaluation
<a name="148"/>      value
<a name="149"/>      )
<a name="150"/>end
<a name="151"/>
<a name="152"/># ARB
<a name="153"/>procedure Arb()				
<a name="154"/>   suspend tab(&amp;pos to *&amp;subject + 1)
<a name="155"/>end
<a name="156"/>
<a name="157"/># ARBNO(P)
<a name="158"/>procedure Arbno(p)			
<a name="159"/>   suspend "" | (p() || Arbno(p))
<a name="160"/>end
<a name="161"/>
<a name="162"/># ARB(I)
<a name="163"/>procedure Arbx(i)			
<a name="164"/>   suspend tab(&amp;pos to *&amp;subject + 1 by i)
<a name="165"/>end
<a name="166"/>
<a name="167"/># BAL
<a name="168"/>procedure Bal()				
<a name="169"/>   suspend Bbal() || Arbno(Bbal)
<a name="170"/>end
<a name="171"/>
<a name="172"/># used by Bal()
<a name="173"/>procedure Bbal()			
<a name="174"/>   suspend (="(" || Arbno(Bbal) || =")") | Notany("()")
<a name="175"/>end
<a name="176"/>
<a name="177"/># BREAK(S)
<a name="178"/>procedure Break(s)			
<a name="179"/>   suspend tab(upto(s) \ 1)
<a name="180"/>end
<a name="181"/>
<a name="182"/># BREAKX(S)
<a name="183"/>procedure Breakx(s)			
<a name="184"/>   suspend tab(upto(s))
<a name="185"/>end
<a name="186"/>
<a name="187"/># P1 P2
<a name="188"/>procedure Cat(p1,p2)			
<a name="189"/>   suspend p1() || p2()
<a name="190"/>end
<a name="191"/>
<a name="192"/># /P
<a name="193"/>procedure Discard(p)			
<a name="194"/>   suspend p() &amp; ""
<a name="195"/>end
<a name="196"/>
<a name="197"/># \S
<a name="198"/>procedure Exog(s)			
<a name="199"/>   suspend s
<a name="200"/>end
<a name="201"/>
<a name="202"/># FIND(S)
<a name="203"/>procedure Find(s)			
<a name="204"/>   suspend tab(find(s) + 1)
<a name="205"/>end
<a name="206"/>
<a name="207"/># LEN(I)
<a name="208"/>procedure Len(i)			
<a name="209"/>   suspend move(i)
<a name="210"/>end
<a name="211"/>
<a name="212"/># P \ i
<a name="213"/>procedure Limit(p,i)			
<a name="214"/>   local j
<a name="215"/>   j := &amp;pos
<a name="216"/>   suspend p() \ i
<a name="217"/>   &amp;pos := j
<a name="218"/>end
<a name="219"/>
<a name="220"/># LOCATE(P)
<a name="221"/>procedure Locate(p)			
<a name="222"/>   suspend tab(&amp;pos to *&amp;subject + 1) &amp; p()
<a name="223"/>end
<a name="224"/>
<a name="225"/># max-first ARB
<a name="226"/>procedure Marb()			
<a name="227"/>   suspend tab(*&amp;subject + 1 to &amp;pos by -1)
<a name="228"/>end
<a name="229"/>
<a name="230"/># NOTANY(S)
<a name="231"/>procedure Notany(s)			
<a name="232"/>   suspend tab(any(~s))
<a name="233"/>end
<a name="234"/>
<a name="235"/># POS(I)
<a name="236"/>procedure Pos(i)			
<a name="237"/>   suspend pos(i + 1) &amp; ""
<a name="238"/>end
<a name="239"/>
<a name="240"/># P = S
<a name="241"/>procedure Replace(p,s)			
<a name="242"/>   suspend p() &amp; s
<a name="243"/>end
<a name="244"/>
<a name="245"/># RPOS(I)
<a name="246"/>procedure Rpos(i)			
<a name="247"/>   suspend pos(-i) &amp; ""
<a name="248"/>end
<a name="249"/>
<a name="250"/># RTAB(I)
<a name="251"/>procedure Rtab(i)			
<a name="252"/>   suspend tab(-i)
<a name="253"/>end
<a name="254"/>
<a name="255"/># SPAN(S)
<a name="256"/>procedure Span(s)			
<a name="257"/>   suspend tab(many(s))
<a name="258"/>end
<a name="259"/>
<a name="260"/># S
<a name="261"/>procedure String(s)			
<a name="262"/>   suspend =s
<a name="263"/>end
<a name="264"/>
<a name="265"/># SUCCEED
<a name="266"/>procedure Succeed()			
<a name="267"/>   suspend |""
<a name="268"/>end
<a name="269"/>
<a name="270"/># TAB(I)
<a name="271"/>procedure Tab(i)			
<a name="272"/>   suspend tab(i + 1)
<a name="273"/>end
<a name="274"/>
<a name="275"/># F(P)
<a name="276"/>procedure Xform(f,p)			
<a name="277"/>   suspend f(p())
<a name="278"/>end
</pre></body></html>
