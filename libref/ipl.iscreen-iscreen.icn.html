<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>iscreen.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#	File:     iscreen.icn
<a name="4"/>#
<a name="5"/>#	Subject:  Procedures for screen functions
<a name="6"/>#
<a name="7"/>#	Author:   Richard L. Goerwitz
<a name="8"/>#
<a name="9"/>#	Date:     May 2, 2001
<a name="10"/>#
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/>#	Version:  1.28
<a name="18"/>#
<a name="19"/>############################################################################
<a name="20"/>#  
<a name="21"/>#      This file contains some rudimentary screen functions for use with
<a name="22"/>#  itlib.icn (termlib-like routines for Icon).
<a name="23"/>#
<a name="24"/>#      clear()              - clears the screen (tries several methods)
<a name="25"/>#      emphasize()          - initiates emphasized (usu. = reverse) mode
<a name="26"/>#      boldface()           - initiates bold mode
<a name="27"/>#      blink()              - initiates blinking mode
<a name="28"/>#      normal()             - resets to normal mode
<a name="29"/>#      message(s)           - displays message s on 2nd-to-last line
<a name="30"/>#      underline()          - initiates underline mode
<a name="31"/>#      status_line(s,s2,p)  - draws status line s on the 3rd-to-last
<a name="32"/>#        screen line; if s is too short for the terminal, s2 is used;
<a name="33"/>#        if p is nonnull then it either centers, left-, or right-justi-
<a name="34"/>#        fies, depending on the value, "c," "l," or "r."
<a name="35"/>#      clear_emphasize()    - horrible way of clearing the screen to all-
<a name="36"/>#        emphasize mode; necessary for many terminals
<a name="37"/>#
<a name="38"/>############################################################################
<a name="39"/>#
<a name="40"/>#  Requires: UNIX
<a name="41"/>#
<a name="42"/>############################################################################
<a name="43"/>#
<a name="44"/>#  Links: itlib (or your OS-specific port of itlib)
<a name="45"/>#
<a name="46"/>############################################################################
<a name="47"/>#
<a name="48"/>#  See also: boldface.icn
<a name="49"/>#
<a name="50"/>############################################################################
<a name="51"/>
<a name="52"/>package ipl.iscreen
<a name="53"/>
<a name="54"/>import
<a name="55"/>   io(writes),
<a name="56"/>   ipl.iolib(er, getval, igoto, iputs)
<a name="57"/>
<a name="58"/>procedure cls()
<a name="59"/>
<a name="60"/>    # Clears the screen.  Tries several methods.
<a name="61"/>    local i
<a name="62"/>
<a name="63"/>    normal()
<a name="64"/>    if not iputs(getval("cl"))
<a name="65"/>    then iputs(igoto(getval("cm"),1,1) | getval("ho"))
<a name="66"/>    if not iputs(getval("cd"))
<a name="67"/>    then {
<a name="68"/>	every i := 1 to getval("li") do {
<a name="69"/>	    iputs(igoto(getval("cm"),1,i))
<a name="70"/>	    iputs(getval("ce"))
<a name="71"/>	}
<a name="72"/>	iputs(igoto(getval("cm"),1,1))
<a name="73"/>    }
<a name="74"/>    return
<a name="75"/>
<a name="76"/>end
<a name="77"/>
<a name="78"/>
<a name="79"/>
<a name="80"/>procedure boldface()
<a name="81"/>    
<a name="82"/>    static bold_str, cookie_str
<a name="83"/>    initial {
<a name="84"/>	if bold_str := getval("md")
<a name="85"/>	then cookie_str := repl(getval("le"|"bc") | "\b", getval("mg"))
<a name="86"/>	else {
<a name="87"/>	    # One global procedure value substituted for another.
<a name="88"/>	    boldface := emphasize
<a name="89"/>	    return emphasize()
<a name="90"/>	}
<a name="91"/>    }	    
<a name="92"/> 
<a name="93"/>    normal()
<a name="94"/>    iputs(\bold_str)
<a name="95"/>    iputs(\cookie_str)
<a name="96"/>    return
<a name="97"/>
<a name="98"/>end
<a name="99"/>
<a name="100"/>
<a name="101"/>
<a name="102"/>procedure blink()
<a name="103"/>    
<a name="104"/>    static blink_str, cookie_str
<a name="105"/>    initial {
<a name="106"/>	if blink_str := getval("mb")
<a name="107"/>	then cookie_str :=
<a name="108"/>		 repl(getval("le"|"bc") | "\b", getval("mg"))
<a name="109"/>	else {
<a name="110"/>	    # One global procedure value substituted for another.
<a name="111"/>	    blink := emphasize
<a name="112"/>	    return emphasize()
<a name="113"/>	}
<a name="114"/>    }	    
<a name="115"/> 
<a name="116"/>    normal()
<a name="117"/>    iputs(\blink_str)
<a name="118"/>    iputs(\cookie_str)
<a name="119"/>    return
<a name="120"/>
<a name="121"/>end
<a name="122"/>
<a name="123"/>
<a name="124"/>
<a name="125"/>procedure emphasize()
<a name="126"/>    
<a name="127"/>    static emph_str, cookie_str
<a name="128"/>    initial {
<a name="129"/>	if emph_str := getval("so")
<a name="130"/>	then cookie_str := repl(getval("le"|"bc") | "\b", getval("sg"))
<a name="131"/>	else {
<a name="132"/>	    if emph_str := getval("mr")
<a name="133"/>	    then cookie_str := repl(getval("le"|"bc") | "\b", getval("mg"))
<a name="134"/>	    else if emph_str := getval("us")
<a name="135"/>	    then cookie_str := repl(getval("le"|"bc") | "\b", getval("ug"))
<a name="136"/>	}
<a name="137"/>    }	    
<a name="138"/> 
<a name="139"/>    normal()
<a name="140"/>    iputs(\emph_str)
<a name="141"/>    iputs(\cookie_str)
<a name="142"/>    return
<a name="143"/>
<a name="144"/>end
<a name="145"/>
<a name="146"/>
<a name="147"/>
<a name="148"/>procedure underline()
<a name="149"/>    
<a name="150"/>    static underline_str, cookie_str
<a name="151"/>    initial {
<a name="152"/>	if underline_str := getval("us")
<a name="153"/>	then cookie_str := repl(getval("le"|"bc") | "\b", getval("ug"))
<a name="154"/>    }
<a name="155"/>
<a name="156"/>    normal()
<a name="157"/>    iputs(\underline_str)
<a name="158"/>    iputs(\cookie_str)
<a name="159"/>    return
<a name="160"/>
<a name="161"/>end
<a name="162"/>
<a name="163"/>
<a name="164"/>
<a name="165"/>procedure normal(mode)
<a name="166"/>
<a name="167"/>    static UN_emph_str, emph_cookie_str,
<a name="168"/>	UN_underline_str, underline_cookie_str,
<a name="169"/>	UN_bold_str, bold_cookie_str
<a name="170"/>
<a name="171"/>    initial {
<a name="172"/>
<a name="173"/>	# Find out code to turn off emphasize (reverse video) mode.
<a name="174"/>	if UN_emph_str := getval("se") then
<a name="175"/>	    # Figure out how many backspaces we need to erase cookies.
<a name="176"/>	    emph_cookie_str := repl(getval("le"|"bc") | "\b", getval("sg"))
<a name="177"/>	else UN_emph_str := ""
<a name="178"/>
<a name="179"/>	# Finally, figure out how to turn off underline mode.
<a name="180"/>	if UN_underline_str := (UN_emph_str ~== getval("ue")) then
<a name="181"/>	    underline_cookie_str := repl(getval("le"|"bc")|"\b", getval("ug"))
<a name="182"/>	else UN_underline_str := ""
<a name="183"/>
<a name="184"/>	# Figure out how to turn off boldface mode.
<a name="185"/>	if UN_bold_str := 
<a name="186"/>	    (UN_underline_str ~== (UN_emph_str ~== getval("me"))) then
<a name="187"/>	    # Figure out how many backspaces we need to erase cookies.
<a name="188"/>	    bold_cookie_str := repl(getval("le"|"bc") | "\b", getval("mg"))
<a name="189"/>	else UN_bold_str := ""
<a name="190"/>
<a name="191"/>    }	    
<a name="192"/>    
<a name="193"/>    iputs("" ~== UN_emph_str) &amp;
<a name="194"/>	iputs(\emph_cookie_str)
<a name="195"/>
<a name="196"/>    iputs("" ~== UN_underline_str) &amp;
<a name="197"/>	iputs(\underline_cookie_str)
<a name="198"/>
<a name="199"/>    iputs("" ~== UN_bold_str) &amp;
<a name="200"/>	iputs(\bold_cookie_str)
<a name="201"/>
<a name="202"/>    return
<a name="203"/>
<a name="204"/>end
<a name="205"/>
<a name="206"/>
<a name="207"/>
<a name="208"/>procedure status_line(s,s2,p)
<a name="209"/>
<a name="210"/>    # Writes a status line on the terminal's third-to-last line
<a name="211"/>    # The only necessary argument is s.  S2 (optional) is used
<a name="212"/>    # for extra narrow screens.  In other words, by specifying
<a name="213"/>    # s2 you give status_line an alternate, shorter status string
<a name="214"/>    # to display, in case the terminal isn't wide enough to sup-
<a name="215"/>    # port s.  If p is nonnull, then the status line is either
<a name="216"/>    # centered (if equal to "c"), left justified ("l"), or right
<a name="217"/>    # justified ("r").
<a name="218"/>
<a name="219"/>    local width
<a name="220"/>
<a name="221"/>    /s := ""; /s2 := ""; /p := "c"
<a name="222"/>    width := getval("co")
<a name="223"/>    if *s &gt; width then {
<a name="224"/>	(*s2 &lt; width, s := s2) |
<a name="225"/>	    er("status_line","Your terminal is too narrow.",4)
<a name="226"/>    }
<a name="227"/>
<a name="228"/>    case p of {
<a name="229"/>	"c"    : s := center(s,width)
<a name="230"/>	"l"    : s := left(s,width)
<a name="231"/>	"r"    : s := right(s,width)
<a name="232"/>	default: runerr("status_line:  Unknown option", p)
<a name="233"/>    }
<a name="234"/>
<a name="235"/>    iputs(igoto(getval("cm"), 1, getval("li")-2))
<a name="236"/>    emphasize(); writes(s)
<a name="237"/>    normal()
<a name="238"/>    return
<a name="239"/>
<a name="240"/>end
<a name="241"/>
<a name="242"/>
<a name="243"/>
<a name="244"/>procedure message(s)
<a name="245"/>
<a name="246"/>    # Display prompt s on the second-to-last line of the screen.
<a name="247"/>    # I hate to use the last line, due to all the problems with
<a name="248"/>    # automatic scrolling.
<a name="249"/>
<a name="250"/>    /s := ""
<a name="251"/>    normal()
<a name="252"/>    iputs(igoto(getval("cm"), 1, getval("li")))
<a name="253"/>    iputs(getval("ce"))
<a name="254"/>    normal()
<a name="255"/>    iputs(igoto(getval("cm"), 1, getval("li")-1))
<a name="256"/>    iputs(getval("ce"))
<a name="257"/>    writes(s[1:getval("co")] | s)
<a name="258"/>    return
<a name="259"/>
<a name="260"/>end
<a name="261"/>
<a name="262"/>
<a name="263"/>
<a name="264"/>procedure clear_underline()
<a name="265"/>
<a name="266"/>    # Horrible way of clearing the screen to all underline mode, but
<a name="267"/>    # the only apparent way we can do it "portably" using the termcap
<a name="268"/>    # capability database.
<a name="269"/>
<a name="270"/>    local i
<a name="271"/>
<a name="272"/>    underline()
<a name="273"/>    iputs(igoto(getval("cm"),1,1))
<a name="274"/>    if getval("am") then {
<a name="275"/>	underline()
<a name="276"/>        every 1 to (getval("li")-1) * getval("co") do
<a name="277"/>	    writes(" ")
<a name="278"/>    }
<a name="279"/>    else {
<a name="280"/>	every i := 1 to getval("li")-1 do {
<a name="281"/>	    iputs(igoto(getval("cm"), 1, i))
<a name="282"/>	    underline()
<a name="283"/>	    writes(repl(" ",getval("co")))
<a name="284"/>	}
<a name="285"/>    }
<a name="286"/>    iputs(igoto(getval("cm"),1,1))
<a name="287"/>
<a name="288"/>end
<a name="289"/>
<a name="290"/>
<a name="291"/>
<a name="292"/>procedure clear_emphasize()
<a name="293"/>
<a name="294"/>    # Horrible way of clearing the screen to all reverse-video, but
<a name="295"/>    # the only apparent way we can do it "portably" using the termcap
<a name="296"/>    # capability database.
<a name="297"/>
<a name="298"/>    local i
<a name="299"/>
<a name="300"/>    emphasize()
<a name="301"/>    iputs(igoto(getval("cm"),1,1))
<a name="302"/>    if getval("am") then {
<a name="303"/>	emphasize()
<a name="304"/>        every 1 to (getval("li")-1) * getval("co") do
<a name="305"/>	    writes(" ")
<a name="306"/>    }
<a name="307"/>    else {
<a name="308"/>	every i := 1 to getval("li")-1 do {
<a name="309"/>	    iputs(igoto(getval("cm"), 1, i))
<a name="310"/>	    emphasize()
<a name="311"/>	    writes(repl(" ",getval("co")))
<a name="312"/>	}
<a name="313"/>    }
<a name="314"/>    iputs(igoto(getval("cm"),1,1))
<a name="315"/>
<a name="316"/>end
</pre></body></html>
