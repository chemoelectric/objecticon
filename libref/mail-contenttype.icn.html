<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>contenttype.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: contenttype.icn 7415 2019-01-25 16:51:58Z rparlett $
<a name="3"/>#
<a name="4"/>
<a name="5"/>package mail
<a name="6"/>
<a name="7"/>import datastruct(SortTable), lang(Text)
<a name="8"/>
<a name="9"/>#
<a name="10"/># This class represents a content type
<a name="11"/>#
<a name="12"/>class ContentType()
<a name="13"/>   private readable
<a name="14"/>      type,
<a name="15"/>      subtype,
<a name="16"/>      parameters
<a name="17"/>
<a name="18"/>   #
<a name="19"/>   # Set type type
<a name="20"/>   #
<a name="21"/>   public set_type(t)
<a name="22"/>      self.type := t
<a name="23"/>      link
<a name="24"/>   end
<a name="25"/>
<a name="26"/>   #
<a name="27"/>   # Get the type
<a name="28"/>   #
<a name="29"/>   public get_type()
<a name="30"/>      return .type
<a name="31"/>   end
<a name="32"/>
<a name="33"/>   #
<a name="34"/>   # Set subtype subtype
<a name="35"/>   #
<a name="36"/>   public set_subtype(s)
<a name="37"/>      self.subtype := s
<a name="38"/>      link
<a name="39"/>   end
<a name="40"/>
<a name="41"/>   #
<a name="42"/>   # Get the subtype
<a name="43"/>   #
<a name="44"/>   public get_subtype()
<a name="45"/>      return .subtype
<a name="46"/>   end
<a name="47"/>
<a name="48"/>   #
<a name="49"/>   # Get the parameter for the given key.
<a name="50"/>   #
<a name="51"/>   # :Parameters :
<a name="52"/>   # :  `key` - the key
<a name="53"/>   public get_parameter(key)
<a name="54"/>      return parameters.member(key)
<a name="55"/>   end
<a name="56"/>
<a name="57"/>   #
<a name="58"/>   # Set the parameter to the given value
<a name="59"/>   # :Parameters :
<a name="60"/>   # :  `key` - the key
<a name="61"/>   # :  `value` - the value
<a name="62"/>   #
<a name="63"/>   public set_parameter(key, value)
<a name="64"/>      parameters.insert(key, value)
<a name="65"/>      link
<a name="66"/>   end
<a name="67"/>
<a name="68"/>   public static parse_rfc2616(s)
<a name="69"/>      return RFC2616Parser().parse_content_type(s)
<a name="70"/>   end   
<a name="71"/>
<a name="72"/>   public static parse(s)
<a name="73"/>      return RFC822Parser().parse_content_type(s)
<a name="74"/>   end   
<a name="75"/>
<a name="76"/>   public to_rfc1521()
<a name="77"/>      local s, e
<a name="78"/>      s := type || "/" || subtype
<a name="79"/>      every e := parameters.entries() do
<a name="80"/>         s ||:= "; " || e.key || "=" || RFC822Parser.escape_1521_value(e.val)
<a name="81"/>      return s
<a name="82"/>   end
<a name="83"/>
<a name="84"/>   public to_rfc2616()
<a name="85"/>      local s, e
<a name="86"/>      s := type || "/" || subtype
<a name="87"/>      every e := parameters.entries() do
<a name="88"/>         s ||:= "; " || e.key || "=" || RFC2616Parser.escape_value(e.val)
<a name="89"/>      return s
<a name="90"/>   end
<a name="91"/>
<a name="92"/>   public new(type, subtype)
<a name="93"/>      self.type := type
<a name="94"/>      self.subtype := subtype
<a name="95"/>      self.parameters := SortTable(, Text.caseless_compare)
<a name="96"/>      return
<a name="97"/>   end
<a name="98"/>end
</pre></body></html>
