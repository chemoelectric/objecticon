<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>test.icn</title></head><body><pre>
<a name="1"/>package ipl.test
<a name="2"/>
<a name="3"/>#
<a name="4"/># Some functions used by the programs in the test directory.
<a name="5"/>#
<a name="6"/>
<a name="7"/>import io, lang, ipl.pdco, util
<a name="8"/>
<a name="9"/>procedure imagex(o)
<a name="10"/>   return unserial(image(o))
<a name="11"/>end
<a name="12"/>
<a name="13"/>procedure unserial(s)
<a name="14"/>   local t
<a name="15"/>   t := ""
<a name="16"/>   s ? {
<a name="17"/>      while t ||:= tab(upto('#') + 1) do {
<a name="18"/>         if tab(many(&amp;digits)) then
<a name="19"/>            t ||:= "*"
<a name="20"/>      }
<a name="21"/>      return t || tab(0)
<a name="22"/>   }
<a name="23"/>end
<a name="24"/>
<a name="25"/>procedure to_stringx(o)
<a name="26"/>   return unserial(to_string(o))
<a name="27"/>end
<a name="28"/>
<a name="29"/>procedure pr_seq(s, e)
<a name="30"/>   local t
<a name="31"/>   writes(@s, ": {")
<a name="32"/>   t := ""
<a name="33"/>   while writes(t, imagex(@e)) do
<a name="34"/>      t := ", "
<a name="35"/>   write("}")
<a name="36"/>end
<a name="37"/>
<a name="38"/>procedure pr_seq2(s, e)
<a name="39"/>   local t
<a name="40"/>   &amp;why := ""
<a name="41"/>   writes(@s, ": {")
<a name="42"/>   t := ""
<a name="43"/>   while writes(t, imagex(@e)) do
<a name="44"/>      t := ", "
<a name="45"/>   if *&amp;why &gt; 0 then
<a name="46"/>      write("} &amp;why=", image(&amp;why))
<a name="47"/>   else
<a name="48"/>      write("}")
<a name="49"/>end
<a name="50"/>
<a name="51"/>procedure yes_no(s, e)
<a name="52"/>   local x
<a name="53"/>   writes(@s, ": ")
<a name="54"/>   if x := @e then
<a name="55"/>      write("yes")
<a name="56"/>   else 
<a name="57"/>      write("no")
<a name="58"/>   return \x
<a name="59"/>end
<a name="60"/>
<a name="61"/>procedure try(s, e)
<a name="62"/>   local x
<a name="63"/>   writes(@s, ": ")
<a name="64"/>   &amp;handler := &amp;current
<a name="65"/>   errorclear()
<a name="66"/>   if x := @e then
<a name="67"/>      write("Succeeded with ", imagex(x))
<a name="68"/>   else {
<a name="69"/>      if &amp;errortext then
<a name="70"/>         write("Error ", &amp;errornumber|-1)
<a name="71"/>      else
<a name="72"/>         write("Failed")
<a name="73"/>   }
<a name="74"/>   &amp;handler := &amp;null
<a name="75"/>   return \x
<a name="76"/>end
<a name="77"/>
<a name="78"/>procedure print(s, e)
<a name="79"/>   local o
<a name="80"/>   writes(@s, ": ")
<a name="81"/>   if o := @e then
<a name="82"/>      write(imagex(o))
<a name="83"/>   else
<a name="84"/>      write("Failed")
<a name="85"/>   return o
<a name="86"/>end
<a name="87"/>
<a name="88"/>procedure pr_type(s, e)
<a name="89"/>   local o
<a name="90"/>   writes(@s, ": ")
<a name="91"/>   if o := @e then
<a name="92"/>      write(type(o))
<a name="93"/>   else
<a name="94"/>      write("Failed")
<a name="95"/>   return o
<a name="96"/>end
<a name="97"/>
<a name="98"/>procedure pr_seq_type(s, e)
<a name="99"/>   local x, t
<a name="100"/>   writes(@s, ": {")
<a name="101"/>   x := set()
<a name="102"/>   while insert(x, type(@e))
<a name="103"/>   t := ""
<a name="104"/>   every writes(t, !sort(x)) do
<a name="105"/>      t := ", "
<a name="106"/>   write("}")
<a name="107"/>end
<a name="108"/>
<a name="109"/>procedure pr_seq_type2(s, e)
<a name="110"/>   local x, t
<a name="111"/>   &amp;why := ""
<a name="112"/>   writes(@s, ": {")
<a name="113"/>   x := set()
<a name="114"/>   while insert(x, type(@e))
<a name="115"/>   t := ""
<a name="116"/>   every writes(t, !sort(x)) do
<a name="117"/>      t := ", "
<a name="118"/>   if *&amp;why &gt; 0 then
<a name="119"/>      write("} &amp;why=", image(&amp;why))
<a name="120"/>   else
<a name="121"/>      write("}")
<a name="122"/>end
<a name="123"/>
<a name="124"/>procedure require(s, e)
<a name="125"/>   return @e | stop(s)
<a name="126"/>end
<a name="127"/>
<a name="128"/>procedure cmp_seq(s, e1, e2)
<a name="129"/>   local x1
<a name="130"/>   writes(@s, ": ")
<a name="131"/>   while x1 := @e1 do {
<a name="132"/>      unless x1 === @e2 then {
<a name="133"/>         write("different")
<a name="134"/>         fail
<a name="135"/>      }
<a name="136"/>   }
<a name="137"/>   if @e2 then {
<a name="138"/>      write("different")
<a name="139"/>      fail
<a name="140"/>   } else {
<a name="141"/>      write("same")
<a name="142"/>      return
<a name="143"/>   }
<a name="144"/>end
<a name="145"/>
<a name="146"/>procedure init_serial()
<a name="147"/>   local e
<a name="148"/>   repeat {
<a name="149"/>      e := create {}
<a name="150"/>      if serial(e) = 100 then break
<a name="151"/>   }
<a name="152"/>   repeat {
<a name="153"/>      e := []
<a name="154"/>      if serial(e) = 100 then break
<a name="155"/>   }
<a name="156"/>end
<a name="157"/>
<a name="158"/>global seed
<a name="159"/>
<a name="160"/># random number generator
<a name="161"/>procedure rand(i)
<a name="162"/>   static a, c, f
<a name="163"/>
<a name="164"/>   initial {
<a name="165"/>      /seed := 0
<a name="166"/>      a := 1103515245
<a name="167"/>      c := 453816694
<a name="168"/>      f := 4.65661286e-10
<a name="169"/>      }
<a name="170"/>
<a name="171"/>   case type(i) of {
<a name="172"/>      "list" | "record" | "string" | "ucs" | "cset": 
<a name="173"/>         return i[rand(0 &lt; *i)]
<a name="174"/>      "table" | "set" :
<a name="175"/>         return Index{ !i, rand(0 &lt; *i) }
<a name="176"/>      default: {
<a name="177"/>         i := need_integer(i, 0)
<a name="178"/>         seed := iand(a * seed + c, 16r7fffffff)
<a name="179"/>         return if i = 0 then f * seed else integer(i * f * seed) + 1
<a name="180"/>      }
<a name="181"/>   }
<a name="182"/>end
</pre></body></html>
