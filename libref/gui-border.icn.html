<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>border.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: border.icn 7415 2019-01-25 16:51:58Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>#
<a name="12"/># This class provides decorative borders.  Optionally, a
<a name="13"/># single other component can be the title of the Border.  This
<a name="14"/># would normally be a Label object, but it could also be a
<a name="15"/># CheckBox or an Icon, or whatever is desired.
<a name="16"/>#
<a name="17"/># Example :-
<a name="18"/># ~
<a name="19"/>#   b := Border()
<a name="20"/>#   # Add a Label as the title
<a name="21"/>#   l := Label()
<a name="22"/>#   l.set_label("Title String")
<a name="23"/>#   b.set_title(l)
<a name="24"/>#   self.add(b)
<a name="25"/># ~
<a name="26"/>class Border(Component)
<a name="27"/>   public 
<a name="28"/>      internal_align, 
<a name="29"/>      title,
<a name="30"/>      content,
<a name="31"/>      y0,
<a name="32"/>      h0
<a name="33"/>
<a name="34"/>   public static const
<a name="35"/>      TITLE_SPACING,
<a name="36"/>      TITLE_OFFSET
<a name="37"/>
<a name="38"/>   private static init()
<a name="39"/>      TITLE_SPACING := env_scale("OI_BORDER_TITLE_SPACING") | scale(2)
<a name="40"/>      TITLE_OFFSET := env_scale("OI_BORDER_TITLE_OFFSET") | scale(6)
<a name="41"/>   end
<a name="42"/>
<a name="43"/>   #
<a name="44"/>   # Set the alignment of the title object.  The input string should be
<a name="45"/>   # ``l'', ``c'' or ``r''.
<a name="46"/>   #
<a name="47"/>   public set_internal_align(x)
<a name="48"/>      self.internal_align := x
<a name="49"/>      link
<a name="50"/>   end
<a name="51"/>
<a name="52"/>   #
<a name="53"/>   # Set the title object to c.
<a name="54"/>   #
<a name="55"/>   public set_title(c)
<a name="56"/>      remove(\self.title)
<a name="57"/>      self.title := c
<a name="58"/>      add(\self.title)
<a name="59"/>      link
<a name="60"/>   end
<a name="61"/>   
<a name="62"/>   #
<a name="63"/>   # Set the content object to c.
<a name="64"/>   #
<a name="65"/>   public set_content(c)
<a name="66"/>      remove(\self.content)
<a name="67"/>      self.content := c
<a name="68"/>      add(self.content)
<a name="69"/>      link
<a name="70"/>   end
<a name="71"/>
<a name="72"/>   public override initially()
<a name="73"/>      \self.content | runerr("No content component specified")
<a name="74"/>      Component.initially()
<a name="75"/>   end
<a name="76"/>
<a name="77"/>   public override display()
<a name="78"/>      border.draw(self.cbwin, self.x, y0, self.w, h0)
<a name="79"/>      if \title then {
<a name="80"/>         # A little space to the left and right of the title.
<a name="81"/>         self.cbwin.erase_area(title.x - TITLE_SPACING, y0,
<a name="82"/>                               title.w + 2 * TITLE_SPACING, border.get_t_inset())
<a name="83"/>      }
<a name="84"/>      self.display_children()
<a name="85"/>   end
<a name="86"/>
<a name="87"/>   public override get_default_width()
<a name="88"/>      local w1
<a name="89"/>      w1 := border.get_total_width() + content.get_preferred_width()
<a name="90"/>      return if \title then
<a name="91"/>         max(w1, title.get_preferred_width() + 2 * TITLE_OFFSET)
<a name="92"/>      else
<a name="93"/>         w1
<a name="94"/>   end
<a name="95"/>
<a name="96"/>   public override get_default_height(dw)
<a name="97"/>      dw -:= border.get_total_width()
<a name="98"/>      return if \title then
<a name="99"/>         max(border.get_t_inset(), title.get_preferred_height()) + content.get_preferred_height(dw) + border.get_b_inset()
<a name="100"/>      else
<a name="101"/>         border.get_total_height() + content.get_preferred_height(dw)
<a name="102"/>   end
<a name="103"/>
<a name="104"/>   public override layout()
<a name="105"/>      local co
<a name="106"/>      if \title then {
<a name="107"/>         #
<a name="108"/>         # Setup title; this gives us its height to work out some other dimensions.
<a name="109"/>         # NB Important not to use resize here as this would fill up the _spec fields,
<a name="110"/>         # and mean later calls to get_preferred_xxx would go wrong (they would get stuck
<a name="111"/>         # with the _spec values) - see ivib/canvas.icn reset_layout() method.
<a name="112"/>         #
<a name="113"/>         title.w := title.get_preferred_width()
<a name="114"/>         title.h := title.get_preferred_height(title.w)
<a name="115"/>         title.x := self.x + case self.internal_align of {
<a name="116"/>            Align.C : (self.w - title.w) / 2
<a name="117"/>            Align.L : TITLE_OFFSET
<a name="118"/>            Align.R : self.w - title.w - TITLE_OFFSET
<a name="119"/>            default : runerr("Incorrect internal_align specifier", self.internal_align)
<a name="120"/>         }
<a name="121"/>         title.y := self.y
<a name="122"/>         title.layout()
<a name="123"/>         content.x := self.x + border.get_l_inset()
<a name="124"/>         co := max(border.get_t_inset(), title.h)
<a name="125"/>         content.y := self.y + co
<a name="126"/>         content.w := self.w - border.get_total_width()
<a name="127"/>         content.h := self.h - co - border.get_b_inset()
<a name="128"/>
<a name="129"/>         y0 := max(self.y, self.y + title.h / 2 - border.get_t_inset() / 2)
<a name="130"/>         h0 := self.y + self.h - self.y0
<a name="131"/>      } else {
<a name="132"/>         content.x := self.x + border.get_l_inset()
<a name="133"/>         content.y := self.y + border.get_t_inset()
<a name="134"/>         content.w := self.w - border.get_total_width()
<a name="135"/>         content.h := self.h - border.get_total_height()
<a name="136"/>         y0 := self.y
<a name="137"/>         h0 := self.h
<a name="138"/>      }
<a name="139"/>      content.layout()
<a name="140"/>   end
<a name="141"/>
<a name="142"/>   public override shift(dx, dy)
<a name="143"/>      Component.shift(dx, dy)
<a name="144"/>      y0 +:= dy
<a name="145"/>   end
<a name="146"/>
<a name="147"/>   public override new()
<a name="148"/>      Component.new()
<a name="149"/>      self.internal_align := Align.L
<a name="150"/>      self.set_border(BevelledBorder())
<a name="151"/>      self.set_constraint("x_fill", &amp;yes)
<a name="152"/>      self.set_constraint("y_fill", &amp;yes)
<a name="153"/>      self.set_constraint("x_weight", 1.0)
<a name="154"/>      self.set_constraint("y_weight",  1.0)
<a name="155"/>      return
<a name="156"/>   end
<a name="157"/>end
<a name="158"/>
<a name="159"/>
</pre></body></html>
