import gui, ipl.lists, graphics

class Untitled(Dialog)
   public target_list, clipboard_cb, primary_cb, data_area, get_data_button
   public component_setup()
      self.setup()
      update_grey()
   end

   public end_dialog()
   end

   public init_dialog()
   end

   public on_quit(ev)
      dispose()
   end

   public update_grey()
      if *target_list.get_selections() > 0 then {
         data_area.set_is_shaded(&no)
         get_data_button.set_is_shaded(&no)
      } else {
         data_area.set_is_shaded(&yes)
         get_data_button.set_is_shaded(&yes)
      }
   end

   public on_target_list(ev)
      update_grey()
   end

   private on_get_data_response(target_type, data)
      /data := "<Failed>"
      data_area.set_contents_str(data)
      data_area.move_cursor(1, 1)
   end

   public on_get_data(ev)
      local ty
      ty := target_list.object_get_selections()[1] | fail
      parent_dialog.request_selection(which_selection(),
                                      [ty],
                                      on_get_data_response)
   end

   public which_selection()
      if clipboard_cb.is_checked() then
         return Selection.CLIPBOARD
      else
         return Selection.PRIMARY
   end

   public on_get_targets(ev)
      parent_dialog.request_selection(which_selection(),
                                      [Selection.TARGETS_TARGET], 
                                      on_get_targets_response)
   end

   private on_get_targets_response(target_type, data)
      if /data then
         target_list.set_contents([])
      else
         # Strip off last \n and split
         target_list.set_contents(str2list(data[1:-1], "\n"))
   end

   private setup()
      local paint_2, panel_2, get_targets_button, label_2, paint_7, layout_4, paint_4, layout_1, paint_1, label_1, border_2, paint_6, layout_3, paint_3, border_content_1, border_content_2, check_box_group_1, border_1, layout_5, paint_5, text_button_3
      self.set_resize(&yes)
      paint_4 := TextPaint("Targets")
      label_1 := Label().
         set_pos("424", "323").
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_paint(paint_4)
      target_list := TextList().
         set_size("200", "150").
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_constraint("y_fill", &yes).
         set_constraint("y_weight", 1.0).
         connect(self.on_target_list, Event.SELECTION_CHANGED).
         set_select_mode(Select.ONE).
         set_contents([""])
      paint_2 := TextPaint("Get")
      get_targets_button := TextButton().
         clear_constraints().
         set_constraint("x_align", Align.L).
         connect(self.on_get_targets, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_2)
      layout_3 := GridLayout().
         set_extra("cells")
      border_content_1 := Component().
         clear_constraints().
         set_layout(layout_3).
         add(target_list).
         add(get_targets_button)
      border_1 := Border().
         clear_constraints().
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_constraint("y_fill", &yes).
         set_constraint("y_weight", 1.0).
         set_title(label_1).
         set_content(border_content_1)
      self.add(border_1)
      paint_5 := TextPaint("Data")
      label_2 := Label().
         set_pos("453", "179").
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_paint(paint_5)
      data_area := EditableTextList().
         set_size("200", "150").
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_constraint("y_fill", &yes).
         set_constraint("y_weight", 1.0).
         set_contents([""]).
         set_is_editable(&no)
      paint_1 := TextPaint("Get")
      get_data_button := TextButton().
         clear_constraints().
         set_constraint("x_align", Align.L).
         connect(self.on_get_data, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_1)
      layout_4 := GridLayout().
         set_extra("cells")
      border_content_2 := Component().
         clear_constraints().
         set_layout(layout_4).
         add(data_area).
         add(get_data_button)
      border_2 := Border().
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_constraint("y_fill", &yes).
         set_constraint("y_weight", 1.0).
         set_title(label_2).
         set_content(border_content_2)
      self.add(border_2)
      paint_6 := TextPaint("Primary")
      primary_cb := CheckBox().
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_toggles(&yes).
         set_paint(paint_6)
      paint_7 := TextPaint("Clipboard")
      clipboard_cb := CheckBox().
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_toggles(&yes).
         set_paint(paint_7)
      paint_3 := TextPaint("Quit")
      text_button_3 := TextButton().
         clear_constraints().
         set_constraint("x_align", Align.R).
         set_constraint("x_weight", 1.0).
         connect(self.on_quit, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_3)
      layout_5 := GridLayout().
         set_doi(0).
         set_extra("cells")
      panel_2 := Panel().
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("w", 2).
         set_constraint("x_align", Align.L).
         set_constraint("x_fill", &yes).
         set_layout(layout_5).
         add(primary_cb).
         add(clipboard_cb).
         add(text_button_3)
      self.add(panel_2)
      layout_1 := GridLayout().
         set_extra("cells")
      self.set_layout(layout_1)
      check_box_group_1 := CheckBoxGroup().
         add(primary_cb).
         add(clipboard_cb).
         set_which_one(clipboard_cb)
   end
end


procedure main()
   local d
   d := Untitled()
   d.show_modal()
end

### Ivib-v2 layout ##
#CCanvas|I18SSuperClass Name|SDialog|SImport Name|Sgui|SButton Groups|L
#0SCheckbox Groups|L1CCanvasCheckBoxGroup|I6SParent Canvas|X1SName|Sche
#ck_box_group_1|SClass Name|SCheckBoxGroup|SImport Name|Sgui|SClass Var
#iable|NSWhich One|CCanvasCheckBox|I34SParent Canvas|X1SName|Sclipboard
#_cb|SClass Name|SCheckBox|SImport Name|Sgui|SClass Variable|I1SX Fix|N
#SY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|S
#l|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T1
#NSx_align|Sl|STooltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent 
#Handlers|L0SClass Variable|I1SParent Component|CCanvasPanel|I28SParent
# Canvas|X1SName|Spanel_2|SClass Name|SPanel|SImport Name|Sgui|SClass V
#ariable|NSX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH
# Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T
#0NSConstraints|T4NSx_align|Sl|Sw|I2Sx_fill|I1Seol|I1STooltip|NSAccel|N
#SLayout delegate|CCanvasGridLayout|I8SDII val|NSDOI val|I0SExtra|Scell
#s|SName|Slayout_5|SClass Name|SGridLayout|SImport Name|Sgui|SClass Var
#iable|NSParent|X9SBorder opts|NSEvent Handlers|L0SClass Variable|NSPar
#ent Component|X1SChildren|L3CCanvasCheckBox|I34SParent Canvas|X1SName|
#Sprimary_cb|SClass Name|SCheckBox|SImport Name|Sgui|SClass Variable|I1
#SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX
# Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstr
#aints|T1NSx_align|Sl|STooltip|NSAccel|NSLayout delegate|NSBorder opts|
#NSEvent Handlers|L0SClass Variable|I1SParent Component|X9SNo click foc
#us|NSAccepts focus Flag|I1SIs Checked Flag|NSIs Checkbox Flag|I1SParen
#t CheckBoxGroup|X4SParent Button Group|NSPaint|CCanvasTextPaint|I6SPar
#ent Canvas|X1SName|Spaint_6|SClass Name|STextPaint|SImport Name|Sgui|S
#Class Variable|NSStr|SPrimary|X5CCanvasTextButton|I35SParent Canvas|X1
#SName|Stext_button_3|SClass Name|STextButton|SImport Name|Sgui|SClass 
#Variable|NSX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NS
#H Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|
#T0NSConstraints|T2NSx_align|Sr|Sx_weight|B1.0|STooltip|NSAccel|NSLayou
#t delegate|NSBorder opts|NSEvent Handlers|L1L2SEvent.ACTION|Son_quit|S
#Class Variable|NSParent Component|X9SNo click focus|NSAccepts focus Fl
#ag|I1SIs Checked Flag|NSIs Checkbox Flag|NSParent CheckBoxGroup|NSPare
#nt Button Group|NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spai
#nt_3|SClass Name|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|SQ
#uit|SPaint down|NSNo click focus|NSAccepts focus Flag|I1SIs Checked Fl
#ag|I1SIs Checkbox Flag|I1SParent CheckBoxGroup|X4SParent Button Group|
#NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_7|SClass Name
#|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|SClipboard|SGen In
#dent|I3SGen Main|I1SGen Component Setup|I1SGen Init Dialog|I1SGen Cons
#tructor|NSDialog Struct|CCDialog|I1SWAttribs|T1NSresize|I1SName|SUntit
#led|SIs Component|NSWidth|NSHeight|NSChildren|L3CCanvasBorder|I31SPare
#nt Canvas|X1SName|Sborder_1|SClass Name|SBorder|SImport Name|Sgui|SCla
#ss Variable|NSX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec
#|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttri
#bs|T0NSConstraints|T4NSx_weight|B1.0|Sx_fill|I1Sy_weight|B1.0|Sy_fill|
#I1STooltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handlers|L0
#SClass Variable|NSParent Component|X1SInternal Alignment|Sl|SChildren|
#L2CCanvasBorderContent|I28SParent Canvas|X1SName|Sborder_content_1|SCl
#ass Name|SComponent|SImport Name|Sgui|SClass Variable|NSX Fix|NSY Fix|
#NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Al
#ign|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T0NSToolt
#ip|NSAccel|NSLayout delegate|CCanvasGridLayout|I8SDII val|NSDOI val|NS
#Extra|Scells|SName|Slayout_3|SClass Name|SGridLayout|SImport Name|Sgui
#|SClass Variable|NSParent|X35SBorder opts|NSEvent Handlers|L0SClass Va
#riable|NSParent Component|X30SChildren|L2CCanvasTextList|I29SParent Ca
#nvas|X1SName|Starget_list|SClass Name|STextList|SImport Name|Sgui|SCla
#ss Variable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spe
#c|S200|SH Spec|S150|SX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded
#|NSWAttribs|T0NSConstraints|T5NSx_weight|B1.0|Sx_fill|I1Sy_weight|B1.0
#|Sy_fill|I1Seol|I1STooltip|NSAccel|NSLayout delegate|NSBorder opts|NSE
#vent Handlers|L1L2SEvent.SELECTION_CHANGED|Son_target_list|SClass Vari
#able|I1SParent Component|X35SSelect Mode|Sone|SContents|L1S|CCanvasTex
#tButton|I35SParent Canvas|X1SName|Sget_targets_button|SClass Name|STex
#tButton|SImport Name|Sgui|SClass Variable|NSX Fix|NSY Fix|NSW Fix|NSH 
#Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0
#STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T1NSx_align|Sl|SToolt
#ip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handlers|L1L2SEvent
#.ACTION|Son_get_targets|SClass Variable|NSParent Component|X35SNo clic
#k focus|NSAccepts focus Flag|I1SIs Checked Flag|NSIs Checkbox Flag|NSP
#arent CheckBoxGroup|NSParent Button Group|NSPaint|CCanvasTextPaint|I6S
#Parent Canvas|X1SName|Spaint_2|SClass Name|STextPaint|SImport Name|Sgu
#i|SClass Variable|NSStr|SGet|SPaint down|NCCanvasLabel|I28SParent Canv
#as|X1SName|Slabel_1|SClass Name|SLabel|SImport Name|Sgui|SClass Variab
#le|NSX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|S424|SY Spec|S323|SW Spec|
#NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttrib
#s|T0NSConstraints|T1NSx_align|Sl|STooltip|NSAccel|NSLayout delegate|NS
#Border opts|NSEvent Handlers|L0SClass Variable|NSParent Component|X30S
#Paint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_4|SClass Name|S
#TextPaint|SImport Name|Sgui|SClass Variable|NSStr|STargets|STitle Obj|
#X53SContent|X35CCanvasBorder|I31SParent Canvas|X1SName|Sborder_2|SClas
#s Name|SBorder|SImport Name|Sgui|SClass Variable|NSX Fix|NSY Fix|NSW F
#ix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|S
#t|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T5NSx_weight|B
#1.0|Sx_fill|I1Sy_weight|B1.0|Sy_fill|I1Seol|I1STooltip|NSAccel|NSLayou
#t delegate|NSBorder opts|NSEvent Handlers|L0SClass Variable|NSParent C
#omponent|X1SInternal Alignment|Sl|SChildren|L2CCanvasBorderContent|I28
#SParent Canvas|X1SName|Sborder_content_2|SClass Name|SComponent|SImpor
#t Name|Sgui|SClass Variable|NSX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|N
#SY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs
# shaded|NSWAttribs|T0NSConstraints|T0NSTooltip|NSAccel|NSLayout delega
#te|CCanvasGridLayout|I8SDII val|NSDOI val|NSExtra|Scells|SName|Slayout
#_4|SClass Name|SGridLayout|SImport Name|Sgui|SClass Variable|NSParent|
#X63SBorder opts|NSEvent Handlers|L0SClass Variable|NSParent Component|
#X58SChildren|L2CCanvasEditableTextList|I30SParent Canvas|X1SName|Sdata
#_area|SClass Name|SEditableTextList|SImport Name|Sgui|SClass Variable|
#I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|S200|SH Sp
#ec|S150|SX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|
#T0NSConstraints|T5NSx_weight|B1.0|Sx_fill|I1Sy_weight|B1.0|Sy_fill|I1S
#eol|I1STooltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handler
#s|L0SClass Variable|I1SParent Component|X63SContents|L1S|SIs editable 
#flag|NSMove on rpress flag|I1CCanvasTextButton|I35SParent Canvas|X1SNa
#me|Sget_data_button|SClass Name|STextButton|SImport Name|Sgui|SClass V
#ariable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NS
#H Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|
#T0NSConstraints|T1NSx_align|Sl|STooltip|NSAccel|NSLayout delegate|NSBo
#rder opts|NSEvent Handlers|L1L2SEvent.ACTION|Son_get_data|SClass Varia
#ble|I1SParent Component|X63SNo click focus|NSAccepts focus Flag|I1SIs 
#Checked Flag|NSIs Checkbox Flag|NSParent CheckBoxGroup|NSParent Button
# Group|NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_1|SCla
#ss Name|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|SGet|SPaint
# down|NCCanvasLabel|I28SParent Canvas|X1SName|Slabel_2|SClass Name|SLa
#bel|SImport Name|Sgui|SClass Variable|NSX Fix|NSY Fix|NSW Fix|NSH Fix|
#NSX Spec|S453|SY Spec|S179|SW Spec|NSH Spec|NSX Align|Sl|SY Align|St|S
#Z|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T1NSx_align|Sl|ST
#ooltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handlers|L0SCla
#ss Variable|NSParent Component|X58SPaint|CCanvasTextPaint|I6SParent Ca
#nvas|X1SName|Spaint_5|SClass Name|STextPaint|SImport Name|Sgui|SClass 
#Variable|NSStr|SData|STitle Obj|X80SContent|X63X9SInitial Focus|NSEven
#t Handlers|L0SLayout delegate|CCanvasGridLayout|I8SDII val|NSDOI val|N
#SExtra|Scells|SName|Slayout_1|SClass Name|SGridLayout|SImport Name|Sgu
#i|SClass Variable|NSParent|X1
