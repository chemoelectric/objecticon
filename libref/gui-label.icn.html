<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>label.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: label.icn 7909 2019-10-09 18:42:01Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>import util, graphics
<a name="12"/>
<a name="13"/>#
<a name="14"/># This class implements a Text label.  The default width and 
<a name="15"/># height are determined by dimensions of text
<a name="16"/>#
<a name="17"/>class Label(Component)
<a name="18"/>   public 
<a name="19"/>      linked_accel,
<a name="20"/>      menu_on_rpress_flag,     # Show context menu on mouse right press event?
<a name="21"/>      paint
<a name="22"/>
<a name="23"/>   #
<a name="24"/>   # Set the label.
<a name="25"/>   # :Parameters :
<a name="26"/>   # :  `x` - The label.
<a name="27"/>   #
<a name="28"/>   public set_label(x)
<a name="29"/>      set_paint(paint_for_string(x))
<a name="30"/>      link
<a name="31"/>   end
<a name="32"/>
<a name="33"/>   #
<a name="34"/>   # Set an image for the label
<a name="35"/>   # :Parameters :
<a name="36"/>   # :  `x` - The image to be displayed
<a name="37"/>   #
<a name="38"/>   public set_image(x)
<a name="39"/>      set_paint(ImagePaint().set_image(x))
<a name="40"/>      link
<a name="41"/>   end
<a name="42"/>
<a name="43"/>   public set_paint(p)
<a name="44"/>      local key
<a name="45"/>      if is_initialized() then {
<a name="46"/>         (\self.paint).finally()
<a name="47"/>         self.paint := p
<a name="48"/>         key := (\linked_accel).accel
<a name="49"/>         self.paint.initially(self, key)
<a name="50"/>         self.invalidate()
<a name="51"/>      } else
<a name="52"/>         self.paint := p
<a name="53"/>      link
<a name="54"/>   end
<a name="55"/>
<a name="56"/>   #
<a name="57"/>   # Link this label to a component; the label will be displayed
<a name="58"/>   # with the component's accelerator key underlined.
<a name="59"/>   #
<a name="60"/>   public set_linked_accel(c)
<a name="61"/>      self.linked_accel := c
<a name="62"/>      link
<a name="63"/>   end
<a name="64"/>
<a name="65"/>   #
<a name="66"/>   # Show the context menu on mouse right press?  Note that this
<a name="67"/>   # assumes that the `paint` is a `TextPaint`; if it is not, then
<a name="68"/>   # `copy_label()` below should be overridden.
<a name="69"/>   #
<a name="70"/>   public set_menu_on_rpress(s)
<a name="71"/>      self.menu_on_rpress_flag := need_flag(s)
<a name="72"/>      link
<a name="73"/>   end
<a name="74"/>
<a name="75"/>   public override initially()
<a name="76"/>      local key
<a name="77"/>      \self.paint | runerr("No label specified")
<a name="78"/>      Component.initially()
<a name="79"/>      key := (\linked_accel).accel
<a name="80"/>      paint.initially(self, key)
<a name="81"/>   end
<a name="82"/>
<a name="83"/>   public override finally()
<a name="84"/>      Component.finally()
<a name="85"/>      paint.finally()
<a name="86"/>   end
<a name="87"/>
<a name="88"/>   public override get_default_width()
<a name="89"/>      return paint.w + border.get_total_width()
<a name="90"/>   end
<a name="91"/>
<a name="92"/>   public override get_default_height()
<a name="93"/>      return paint.h + border.get_total_height()
<a name="94"/>   end
<a name="95"/>
<a name="96"/>   public override display()
<a name="97"/>      paint.draw_rect(self.cbwin, border.float(self, paint))
<a name="98"/>      border.draw_rect(self.cbwin, self)
<a name="99"/>      if should_draw_focus() then
<a name="100"/>         border.draw_focus_rect(self.cbwin, self)
<a name="101"/>   end
<a name="102"/>
<a name="103"/>   public copy_label()
<a name="104"/>      parent_dialog.own_selection(Selection.CLIPBOARD, StaticTextSelectionOwner(paint.str))
<a name="105"/>   end
<a name="106"/>
<a name="107"/>   public create_context_menu(e)
<a name="108"/>      return Menu().
<a name="109"/>         add(TextMenuItem().set_label("Copy").connect(copy_label, Event.ACTION))
<a name="110"/>   end
<a name="111"/>
<a name="112"/>   public handle_rpress(e)
<a name="113"/>      local m, pm
<a name="114"/>      if \menu_on_rpress_flag &amp;
<a name="115"/>         m := create_context_menu(e) then 
<a name="116"/>      {
<a name="117"/>         pm := PopupMenu()
<a name="118"/>         pm.popup(self, m, e.x, e.y)
<a name="119"/>      }
<a name="120"/>   end
<a name="121"/>
<a name="122"/>   public override new()
<a name="123"/>      Component.new()
<a name="124"/>      set_constraint("x_align", Align.L)
<a name="125"/>      set_border(NullBorder().set_align(Align.L, Align.C))
<a name="126"/>      connect(self.handle_rpress, Event.MOUSE_RIGHT_PRESS)
<a name="127"/>      return
<a name="128"/>   end
<a name="129"/>end
<a name="130"/>
<a name="131"/>
</pre></body></html>
