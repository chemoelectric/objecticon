<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>ansi.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/># 
<a name="3"/>#	File:     ansi.icn
<a name="4"/># 
<a name="5"/>#	Subject:  Procedures for ANSI-based terminal control
<a name="6"/># 
<a name="7"/>#	Authors:  Ralph E. Griswold and Richard Goerwitz
<a name="8"/>#
<a name="9"/>#	Date:     August 14, 1996
<a name="10"/># 
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/>#	Version:  1.5
<a name="18"/>#
<a name="19"/>############################################################################
<a name="20"/># 
<a name="21"/>#     This package of procedures implements a subset of the ANSI terminal
<a name="22"/>#  control sequences.  The names of the procedures are taken directly from
<a name="23"/>#  the ANSI names.  If it is necessary to use these routines with non-ANSI
<a name="24"/>#  devices, link in iolib.icn, and (optionally) iscreen.icn as well.  Use
<a name="25"/>#  will be made of whatever routines are made available via either of these
<a name="26"/>#  libraries.  Be careful of naming conflicts if you link in iscreen.icn.
<a name="27"/>#  It contains procedures like "clear" and "boldface."
<a name="28"/>#
<a name="29"/>#	 CUB(i)		Moves the cursor left i columns
<a name="30"/>#	 CUD(i)		Moves the cursor down i rows
<a name="31"/>#	 CUF(i)		Moves the cursor right i columns
<a name="32"/>#	 CUP(i,j)	Moves the cursor to row i, column j
<a name="33"/>#	 CUU(i)		Moves the cursor up i rows
<a name="34"/>#	 ED(i)		Erases screen: i = 0, cursor to end; i = 1,
<a name="35"/>#			   beginning to cursor; i = 2, all (default 2)
<a name="36"/>#	 EL(i)		Erases data in cursor row: i = 0, cursor to
<a name="37"/>#			   end; i = 1, beginning to cursor; i = 2, all
<a name="38"/>#			   (default 0)
<a name="39"/>#	 SGR(i)		Sets video attributes: 0 = off; 1 = bold; 4 =
<a name="40"/>#			   underscore; 5 = blink; 7 = reverse (default
<a name="41"/>#			   0)	
<a name="42"/>#
<a name="43"/>#     Note that not all so-called ANSI terminals support every ANSI
<a name="44"/>#  screen control sequence - not even the limited subset included in
<a name="45"/>#  this file.
<a name="46"/>#
<a name="47"/>#     If you plan on using these routines with non-ANSI magic-cookie
<a name="48"/>#  terminals (e.g. a Wyse-50) then it is strongly recommended that you
<a name="49"/>#  link in iolib or itlib *and* iscreen (not just iolib or itlib by
<a name="50"/>#  itself).  The routines WILL WORK with most magic cookie terminals;
<a name="51"/>#  they just don't always get all the modes displayed (because they
<a name="52"/>#  are basically too busy erasing the cookies).
<a name="53"/>#
<a name="54"/>############################################################################
<a name="55"/>#
<a name="56"/>#  Links: iolib or itlib, iscreen (all optional)
<a name="57"/>#
<a name="58"/>############################################################################
<a name="59"/>
<a name="60"/># For DOS, or any system using ANSI-conformant output devices, there
<a name="61"/># is no need to link any routines in.
<a name="62"/>
<a name="63"/># For UNIX systems, you may choose to link in itlib or iolib, and (if
<a name="64"/># desired) iscreen as well.  Some of these may be in the IPL.  You can
<a name="65"/># get any that aren't from Richard Goerwitz (goer@sophist.uchicago.edu).
<a name="66"/>
<a name="67"/>package ipl.ansi
<a name="68"/>
<a name="69"/>import
<a name="70"/>   io(stop, writes),
<a name="71"/>   ipl.iolib(getname, getval, igoto, iputs),
<a name="72"/>   ipl.iscreen(cls, emphasize, normal, boldface, underline, blink)
<a name="73"/>
<a name="74"/>procedure _isANSI()
<a name="75"/>    static isANSI
<a name="76"/>    initial {
<a name="77"/>	if find("MS-DOS",&amp;features) then {
<a name="78"/>	    isANSI := 1
<a name="79"/>	} else {
<a name="80"/>           if find("ansi",map(getname())) | getname() == "li"
<a name="81"/>           then isANSI := 1
<a name="82"/>           else isANSI := &amp;null
<a name="83"/>	}
<a name="84"/>    }
<a name="85"/>    return \isANSI
<a name="86"/>end
<a name="87"/>
<a name="88"/>procedure CUD(i)
<a name="89"/>    if _isANSI()
<a name="90"/>    then writes("\^[[",i,"B")
<a name="91"/>    else {
<a name="92"/>       unless iputs(igoto(getval("DO"),i)) then {
<a name="93"/>	    every 1 to i do
<a name="94"/>		iputs(getval("do")) | stop("CUD:  no do capability")
<a name="95"/>	}
<a name="96"/>    }
<a name="97"/>    return
<a name="98"/>end
<a name="99"/>
<a name="100"/>procedure CUB(i)
<a name="101"/>    if _isANSI()
<a name="102"/>    then writes("\^[[",i,"D")
<a name="103"/>    else {
<a name="104"/>       unless iputs(igoto(getval("LE"),i)) then {
<a name="105"/>	    every 1 to i do
<a name="106"/>		iputs(getval("le")) | stop("CUB:  no le capability")
<a name="107"/>	}
<a name="108"/>    }
<a name="109"/>    return
<a name="110"/>end
<a name="111"/>
<a name="112"/>procedure CUF(i)
<a name="113"/>    if _isANSI()
<a name="114"/>    then writes("\^[[",i,"C")
<a name="115"/>    else {
<a name="116"/>       unless iputs(igoto(getval("RI"),i)) then {
<a name="117"/>	    every 1 to i do
<a name="118"/>		iputs(getval("nd")) | stop("CUF:  no nd capability")
<a name="119"/>	}
<a name="120"/>    }
<a name="121"/>    return
<a name="122"/>end
<a name="123"/>
<a name="124"/>procedure CUP(i,j)
<a name="125"/>    if _isANSI()
<a name="126"/>    then writes("\^[[",i,";",j,"H")
<a name="127"/>    else iputs(igoto(getval("cm"), j, i)) | stop("CUP:  no cm capability")
<a name="128"/>    return
<a name="129"/>end
<a name="130"/>
<a name="131"/>procedure CUU(i)
<a name="132"/>    if _isANSI()
<a name="133"/>    then writes("\^[[",i,"A")
<a name="134"/>    else {
<a name="135"/>       unless iputs(igoto(getval("UP"),i)) then {
<a name="136"/>	    every 1 to i do
<a name="137"/>		iputs(getval("up")) | stop("CUU:  no up capability")
<a name="138"/>	}
<a name="139"/>    }
<a name="140"/>    return
<a name="141"/>end
<a name="142"/>
<a name="143"/>procedure ED(i)
<a name="144"/>    /i := 2
<a name="145"/>    if _isANSI() then {
<a name="146"/>	writes("\^[[",i,"J")
<a name="147"/>    } else {
<a name="148"/>	case i of {
<a name="149"/>	    0:  iputs(getval("cd")) | stop("ED:  no cd capability")
<a name="150"/>	    1:  stop("ED:  termcap doesn't specify capability")
<a name="151"/>	    2:  cls()
<a name="152"/>	    default:  stop("ED:  unknown clear code, ",i)
<a name="153"/>	}
<a name="154"/>    }
<a name="155"/>   return
<a name="156"/>end
<a name="157"/>
<a name="158"/>procedure EL(i)
<a name="159"/>    /i := 0
<a name="160"/>    if _isANSI() then {
<a name="161"/>	if i = 0
<a name="162"/>	then writes("\^[[K")
<a name="163"/>	else writes("\^[[",i,"K")
<a name="164"/>    } else {
<a name="165"/>	case i of {
<a name="166"/>	    0:  iputs(getval("ce")) | stop("EL:  no ce capability")
<a name="167"/>	    1:  stop("EL:  termcap doesn't specify capability")
<a name="168"/>	    2:  stop("EL:  try using CUP to go to col 1, then EL(0)")
<a name="169"/>	    default:  stop("EL:  unknown line clear code, ",i)
<a name="170"/>	}
<a name="171"/>    }
<a name="172"/>   return
<a name="173"/>end
<a name="174"/>
<a name="175"/>procedure SGR(i)
<a name="176"/>    /i := 0
<a name="177"/>    if _isANSI() then {
<a name="178"/>	writes("\^[[",i,"m")
<a name="179"/>    } else {
<a name="180"/>	case i of {
<a name="181"/>	    0: normal()
<a name="182"/>	    1: boldface()
<a name="183"/>	    4: underline()
<a name="184"/>	    5: blink()
<a name="185"/>	    7: emphasize()
<a name="186"/>	    default:  stop("SGR:  unknown mode, ",i)
<a name="187"/>	}
<a name="188"/>    }
<a name="189"/>   return
<a name="190"/>end
</pre></body></html>
