import
   gui, graphics

$ifdef _PLAN9
import io
$endif

class DragLabel(Label)
   public can_drag(ev)
      return "Hello"
   end

   public new()
      cast(self,Component).new()
      set_allow_drag(1)
      return
   end

end

class Untitled(Dialog)
   private
      panel_1,
      label_1,
      text_button_1,
      text_button_2,
      text_button_3,
      panel_2,
      text_button_4,
      text_button_5,
      text_button_6,
      text_display_1,
      panel_3,
      text_button_7,
      text_button_8,
      text_button_9,
      text_button_10,
      text_button_11

   private code_to_str(n)
      return case n of {
         Mouse.LEFT_PRESS: "Mouse.LEFT_PRESS"
         Mouse.MIDDLE_PRESS: "Mouse.MIDDLE_PRESS"
         Mouse.RIGHT_PRESS: "Mouse.RIGHT_PRESS"
         Mouse.LEFT_RELEASE: "Mouse.LEFT_RELEASE"
         Mouse.MIDDLE_RELEASE: "Mouse.MIDDLE_RELEASE"
         Mouse.RIGHT_RELEASE: "Mouse.RIGHT_RELEASE"
         Mouse.DRAG: "Mouse.DRAG"
         Mouse.MOVEMENT: "Mouse.MOVEMENT"
         Mouse.WHEEL_UP: "Mouse.WHEEL_UP"
         Mouse.WHEEL_DOWN: "Mouse.WHEEL_DOWN"
         Mouse.ENTER: "Mouse.ENTER"
         Mouse.EXIT: "Mouse.EXIT"
         default: "?"||image(n)
      }
   end

   private type_to_str(n)
      return case n of {
         Event.MOUSE_LEFT_PRESS: "MOUSE_LEFT_PRESS"
         Event.MOUSE_MIDDLE_PRESS: "MOUSE_MIDDLE_PRESS"
         Event.MOUSE_RIGHT_PRESS: "MOUSE_RIGHT_PRESS"
         Event.MOUSE_LEFT_RELEASE: "MOUSE_LEFT_RELEASE"
         Event.MOUSE_MIDDLE_RELEASE: "MOUSE_MIDDLE_RELEASE"
         Event.MOUSE_RIGHT_RELEASE: "MOUSE_RIGHT_RELEASE"
         Event.MOUSE_LEFT_DRAG: "MOUSE_LEFT_DRAG"
         Event.MOUSE_MIDDLE_DRAG: "MOUSE_MIDDLE_DRAG"
         Event.MOUSE_RIGHT_DRAG: "MOUSE_RIGHT_DRAG"
         Event.MOUSE_MOVEMENT: "MOUSE_MOVEMENT"
         Event.MOUSE_WHEEL_UP: "MOUSE_WHEEL_UP"
         Event.MOUSE_WHEEL_DOWN: "MOUSE_WHEEL_DOWN"
         Event.WINDOW_RESIZE: "WINDOW_RESIZE"
         Event.WINDOW_CLOSE_BUTTON: "WINDOW_CLOSE_BUTTON"
         Event.ICON: "ICON"
         Event.BUTTON_RELEASE: "BUTTON_RELEASE"
         Event.BUTTON_PRESS: "BUTTON_PRESS"
         Event.BUTTON_HELD: "BUTTON_HELD"
         Event.SELECTION_CHANGED: "SELECTION_CHANGED"
         Event.CONTENT_CHANGED: "CONTENT_CHANGED"
         Event.CURSOR_MOVED: "CURSOR_MOVED"
         Event.VALUE_CHANGED: "VALUE_CHANGED"
         Event.ACTION: "ACTION"
         Event.TREE_NODE_EXPANSION: "TREE_NODE_EXPANSION"
         Event.SIZER_PRESS: "SIZER_PRESS"
         Event.SIZER_DRAG: "SIZER_DRAG"
         Event.SIZER_RELEASE: "SIZER_RELEASE"
         Event.MOUSE_ENTER: "MOUSE_ENTER"
         Event.MOUSE_EXIT: "MOUSE_EXIT"
         Event.KEY_PRESS: "KEY_PRESS"
         Event.KEY_RELEASE: "KEY_RELEASE"
         Event.GOT_FOCUS: "GOT_FOCUS"
         Event.LOST_FOCUS: "LOST_FOCUS"
         Event.DIALOG_DISPOSED: "DIALOG_DISPOSED"
         default: "?"||image(n)
      }
   end

   private ev_to_str(ev)
      local s
      if /ev then return "&null"
      s := code_to_str(ev.code)||" (" ||ev.x||","||ev.y||") " || ev.time
      if \ev.shift then s ||:= " shift"
      if \ev.lock then s ||:= " lock"
      if \ev.ctrl then s ||:= " ctrl"
      if \ev.meta then s ||:= " meta"
      if \ev.meta2 then s ||:= " meta2"
      if \ev.meta3 then s ||:= " meta3"
      if \ev.meta4 then s ||:= " meta4"
      if \ev.meta5 then s ||:= " meta5"
      if \ev.release then s ||:= " rel"
      return s
   end

   private on_event(ev)
      if not text_button_10.is_checked() then
         text_display_1.log([ev_to_str(ev)],100)
   end

   public component_setup()
      self.setup()
      connect(on_event, Event.ICON)
   end

   public end_dialog()
   end

   public init_dialog()
   end

   private on_text_button_3(ev)
      dispose()
   end

   private on_text_button_7(ev)
      FileDialog().show_modal(self)
   end

   private on_test_button_event(ev,src,type)
      if not text_button_10.is_checked() then
         text_display_1.log(["B:t="||type_to_str(type)||" e="||ev_to_str(ev)],100)
   end

   private on_text_button_8(ev)
   end

   private on_text_button_9(ev)
      own_selection(Selection.CLIPBOARD, StaticTextSelectionOwner(text_display_1.get_contents_str()))
   end

   private on_text_button_8p(ev)
   end

   private on_text_button_10(ev)

   end

   private on_text_button_1(ev)
      if text_button_1.is_checked() then
         win.grab_pointer()
      else
         win.ungrab_pointer()
   end

   private on_text_button_5(ev)
      text_button_6.set_is_checked(&no)
$ifdef _PLAN9
      if text_button_5.is_checked() then
         Files.string_to_file(win.get_dir() || "/wctl", "set -layer 1")
      else
         Files.string_to_file(win.get_dir() || "/wctl", "set -layer 0")
$endif
   end

   private on_text_button_6(ev)
      text_button_5.set_is_checked(&no)
$ifdef _PLAN9
      if text_button_6.is_checked() then
         Files.string_to_file(win.get_dir() || "/wctl", "set -layer -1")
      else
         Files.string_to_file(win.get_dir() || "/wctl", "set -layer 0")
$endif
   end

   private setup()
      local paint_2, paint_14, paint_7, paint_11, layout_4, paint_4, paint_9, paint_13, paint_6, paint_10, layout_3, paint_8, paint_12, border_1, layout_2
      self.set_resize(&yes)
      self.set_size(506, 393)
      text_display_1 := TextDisplay().
         set_size(299, 260).
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_constraint("y_fill", &yes).
         set_constraint("y_weight", 1.0).
         set_contents([])
      self.add(text_display_1)
      paint_13 := TextPaint("Tooltip")
      paint_14 := TextPaint("Tooltip")
      text_button_11 := TextButton().
         clear_constraints().
         set_tooltip(paint_14).
         set_toggles(&no).
         set_paint(paint_13)
      paint_6 := TextPaint("Above")
      text_button_5 := TextButton().
         clear_constraints().
         connect(self.on_text_button_5, Event.ACTION).
         set_toggles(&yes).
         set_paint(paint_6)
      paint_7 := TextPaint("Below")
      text_button_6 := TextButton().
         clear_constraints().
         connect(self.on_text_button_6, Event.ACTION).
         set_toggles(&yes).
         set_paint(paint_7)
      paint_2 := TextPaint("Grab")
      text_button_1 := TextButton().
         clear_constraints().
         connect(self.on_text_button_1, Event.ACTION).
         set_toggles(&yes).
         set_paint(paint_2)
      paint_12 := TextPaint("DnD")
      border_1 := PlainBorder()
      label_1 := DragLabel().
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_border(border_1).
         set_paint(paint_12)
      layout_3 := GridLayout().
         set_doi(0).
         set_extra("cells")
      panel_2 := Panel().
         clear_constraints().
         set_constraint("eol", &yes).
         set_layout(layout_3).
         add(text_button_11).
         add(text_button_5).
         add(text_button_6).
         add(text_button_1).
         add(label_1)
      self.add(panel_2)
      paint_4 := TextPaint("Quit")
      text_button_3 := TextButton().
         clear_constraints().
         connect(self.on_text_button_3, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_4)
      paint_10 := TextPaint("Copy")
      text_button_9 := TextButton().
         clear_constraints().
         connect(self.on_text_button_9, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_10)
      paint_11 := TextPaint("Pause")
      text_button_10 := TextButton().
         clear_constraints().
         connect(self.on_text_button_10, Event.ACTION).
         set_toggles(&yes).
         set_paint(paint_11)
      paint_8 := TextPaint("Modal")
      text_button_7 := TextButton().
         clear_constraints().
         connect(self.on_text_button_7, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_8)
      paint_9 := TextPaint("Test")
      text_button_8 := TextButton().
         clear_constraints().
         connect(self.on_test_button_event, &null).
         connect(self.on_text_button_8, Event.ACTION).
         connect(self.on_text_button_8p, Event.BUTTON_PRESS).
         set_toggles(&no).
         set_paint(paint_9)
      layout_4 := GridLayout().
         set_doi(0).
         set_extra("cells")
      panel_3 := Panel().
         clear_constraints().
         set_layout(layout_4).
         add(text_button_3).
         add(text_button_9).
         add(text_button_10).
         add(text_button_7).
         add(text_button_8)
      self.add(panel_3)
      self.connect(self.dispose, Event.WINDOW_CLOSE_BUTTON)
      layout_2 := GridLayout().
         set_extra("cells")
      self.set_layout(layout_2)
   end
end

procedure main()
   local d
   d := Untitled()
   d.show_modal()
end

### Ivib-v2 layout ##
#CCanvas|I18SSuperClass Name|SDialog|SImport Name|Sgui|SButton Groups|L
#0SCheckbox Groups|L0SGen Indent|I3SGen Main|I1SGen Component Setup|I1S
#Gen Init Dialog|I1SGen Constructor|NSDialog Struct|CCDialog|I1SWAttrib
#s|T1NSresize|I1SName|SUntitled|SIs Component|NSWidth|S506|SHeight|S393
#|SChildren|L3CCanvasTextDisplay|I28SParent Canvas|X1SName|Stext_displa
#y_1|SClass Name|STextDisplay|SImport Name|Sgui|SClass Variable|I1SX Fi
#x|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|I299SH Spec|I260S
#X Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConst
#raints|T5NSx_weight|B1.0|Sx_fill|I1Sy_weight|B1.0|Sy_fill|I1Seol|I1STo
#oltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handlers|NSClass
# Variable|I1SParent Component|X1SContents|L0CCanvasPanel|I28SParent Ca
#nvas|X1SName|Spanel_2|SClass Name|SPanel|SImport Name|Sgui|SClass Vari
#able|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH S
#pec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0N
#SConstraints|T1NSeol|I1STooltip|NSAccel|NSLayout delegate|CCanvasGridL
#ayout|I8SDII val|NSDOI val|I0SExtra|Scells|SName|Slayout_3|SClass Name
#|SGridLayout|SImport Name|Sgui|SClass Variable|NSParent|X11SBorder opt
#s|NSEvent Handlers|NSClass Variable|I1SParent Component|X1SChildren|L5
#CCanvasTextButton|I35SParent Canvas|X1SName|Stext_button_11|SClass Nam
#e|STextButton|SImport Name|Sgui|SClass Variable|I1SX Fix|NSY Fix|NSW F
#ix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|S
#t|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T0NSTooltip|CC
#anvasTextPaint|I6SParent Canvas|X1SName|Spaint_14|SClass Name|STextPai
#nt|SImport Name|Sgui|SClass Variable|NSStr|STooltip|SAccel|NSLayout de
#legate|NSBorder opts|NSEvent Handlers|L0SClass Variable|I1SParent Comp
#onent|X11SNo click focus|NSAccepts focus Flag|I1SIs Checked Flag|NSIs 
#Checkbox Flag|NSParent CheckBoxGroup|NSParent Button Group|NSPaint|CCa
#nvasTextPaint|I6SParent Canvas|X1SName|Spaint_13|SClass Name|STextPain
#t|SImport Name|Sgui|SClass Variable|NSStr|STooltip|SPaint down|NCCanva
#sTextButton|I35SParent Canvas|X1SName|Stext_button_5|SClass Name|SText
#Button|SImport Name|Sgui|SClass Variable|I1SX Fix|NSY Fix|NSW Fix|NSH 
#Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0
#STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T0NSTooltip|NSAccel|N
#SLayout delegate|NSBorder opts|NSEvent Handlers|L1L2SEvent.ACTION|Son_
#text_button_5|SClass Variable|I1SParent Component|X11SNo click focus|N
#SAccepts focus Flag|I1SIs Checked Flag|NSIs Checkbox Flag|I1SParent Ch
#eckBoxGroup|NSParent Button Group|NSPaint|CCanvasTextPaint|I6SParent C
#anvas|X1SName|Spaint_6|SClass Name|STextPaint|SImport Name|Sgui|SClass
# Variable|NSStr|SAbove|SPaint down|NCCanvasTextButton|I35SParent Canva
#s|X1SName|Stext_button_6|SClass Name|STextButton|SImport Name|Sgui|SCl
#ass Variable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Sp
#ec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAtt
#ribs|T0NSConstraints|T0NSTooltip|NSAccel|NSLayout delegate|NSBorder op
#ts|NSEvent Handlers|L1L2SEvent.ACTION|Son_text_button_6|SClass Variabl
#e|I1SParent Component|X11SNo click focus|NSAccepts focus Flag|I1SIs Ch
#ecked Flag|NSIs Checkbox Flag|I1SParent CheckBoxGroup|NSParent Button 
#Group|NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_7|SClas
#s Name|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|SBelow|SPain
#t down|NCCanvasTextButton|I35SParent Canvas|X1SName|Stext_button_1|SCl
#ass Name|STextButton|SImport Name|Sgui|SClass Variable|I1SX Fix|NSY Fi
#x|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY 
#Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T0NSToo
#ltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handlers|L1L2SEve
#nt.ACTION|Son_text_button_1|SClass Variable|I1SParent Component|X11SNo
# click focus|NSAccepts focus Flag|I1SIs Checked Flag|NSIs Checkbox Fla
#g|I1SParent CheckBoxGroup|NSParent Button Group|NSPaint|CCanvasTextPai
#nt|I6SParent Canvas|X1SName|Spaint_2|SClass Name|STextPaint|SImport Na
#me|Sgui|SClass Variable|NSStr|SGrab|SPaint down|NCCanvasLabel|I28SPare
#nt Canvas|X1SName|Slabel_1|SClass Name|SDragLabel|SImport Name|Sgui|SC
#lass Variable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW S
#pec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAt
#tribs|T0NSConstraints|T1NSx_align|Sl|STooltip|NSAccel|NSLayout delegat
#e|NSBorder opts|CCanvasPlainBorder|I13SParent Canvas|X1SName|Sborder_1
#|SClass Name|SPlainBorder|SImport Name|Sgui|SClass Variable|NSLeft ins
#et|NSRight inset|NSTop inset|NSBottom inset|NSX align|NSY align|NSLine
# width|NSHas empty|NSEvent Handlers|L0SClass Variable|I1SParent Compon
#ent|X11SPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_12|SCla
#ss Name|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|SDnD|CCanva
#sPanel|I28SParent Canvas|X1SName|Spanel_3|SClass Name|SPanel|SImport N
#ame|Sgui|SClass Variable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY
# Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs s
#haded|NSWAttribs|T0NSConstraints|T0NSTooltip|NSAccel|NSLayout delegate
#|CCanvasGridLayout|I8SDII val|NSDOI val|I0SExtra|Scells|SName|Slayout_
#4|SClass Name|SGridLayout|SImport Name|Sgui|SClass Variable|NSParent|X
#46SBorder opts|NSEvent Handlers|NSClass Variable|I1SParent Component|X
#1SChildren|L5CCanvasTextButton|I35SParent Canvas|X1SName|Stext_button_
#3|SClass Name|STextButton|SImport Name|Sgui|SClass Variable|I1SX Fix|N
#SY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|S
#l|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T0
#NSTooltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent Handlers|L1L
#2SEvent.ACTION|Son_text_button_3|SClass Variable|I1SParent Component|X
#46SNo click focus|NSAccepts focus Flag|I1SIs Checked Flag|NSIs Checkbo
#x Flag|NSParent CheckBoxGroup|NSParent Button Group|NSPaint|CCanvasTex
#tPaint|I6SParent Canvas|X1SName|Spaint_4|SClass Name|STextPaint|SImpor
#t Name|Sgui|SClass Variable|NSStr|SQuit|SPaint down|NCCanvasTextButton
#|I35SParent Canvas|X1SName|Stext_button_9|SClass Name|STextButton|SImp
#ort Name|Sgui|SClass Variable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spe
#c|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0
#SIs shaded|NSWAttribs|T0NSConstraints|T0NSTooltip|NSAccel|NSLayout del
#egate|NSBorder opts|NSEvent Handlers|L1L2SEvent.ACTION|Son_text_button
#_9|SClass Variable|I1SParent Component|X46SNo click focus|NSAccepts fo
#cus Flag|I1SIs Checked Flag|NSIs Checkbox Flag|NSParent CheckBoxGroup|
#NSParent Button Group|NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SNam
#e|Spaint_10|SClass Name|STextPaint|SImport Name|Sgui|SClass Variable|N
#SStr|SCopy|SPaint down|NCCanvasTextButton|I35SParent Canvas|X1SName|St
#ext_button_10|SClass Name|STextButton|SImport Name|Sgui|SClass Variabl
#e|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec
#|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSCo
#nstraints|T0NSTooltip|NSAccel|NSLayout delegate|NSBorder opts|NSEvent 
#Handlers|L1L2SEvent.ACTION|Son_text_button_10|SClass Variable|I1SParen
#t Component|X46SNo click focus|NSAccepts focus Flag|I1SIs Checked Flag
#|NSIs Checkbox Flag|I1SParent CheckBoxGroup|NSParent Button Group|NSPa
#int|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_11|SClass Name|ST
#extPaint|SImport Name|Sgui|SClass Variable|NSStr|SPause|SPaint down|NC
#CanvasTextButton|I35SParent Canvas|X1SName|Stext_button_7|SClass Name|
#STextButton|SImport Name|Sgui|SClass Variable|I1SX Fix|NSY Fix|NSW Fix
#|NSH Fix|NSX Spec|NSY Spec|NSW Spec|NSH Spec|NSX Align|Sl|SY Align|St|
#SZ|I0STab ord|I0SIs shaded|NSWAttribs|T0NSConstraints|T0NSTooltip|NSAc
#cel|NSLayout delegate|NSBorder opts|NSEvent Handlers|L1L2SEvent.ACTION
#|Son_text_button_7|SClass Variable|I1SParent Component|X46SNo click fo
#cus|NSAccepts focus Flag|I1SIs Checked Flag|NSIs Checkbox Flag|NSParen
#t CheckBoxGroup|NSParent Button Group|NSPaint|CCanvasTextPaint|I6SPare
#nt Canvas|X1SName|Spaint_8|SClass Name|STextPaint|SImport Name|Sgui|SC
#lass Variable|NSStr|SModal|SPaint down|NCCanvasTextButton|I35SParent C
#anvas|X1SName|Stext_button_8|SClass Name|STextButton|SImport Name|Sgui
#|SClass Variable|I1SX Fix|NSY Fix|NSW Fix|NSH Fix|NSX Spec|NSY Spec|NS
#W Spec|NSH Spec|NSX Align|Sl|SY Align|St|SZ|I0STab ord|I0SIs shaded|NS
#WAttribs|T0NSConstraints|T0NSTooltip|NSAccel|NSLayout delegate|NSBorde
#r opts|NSEvent Handlers|L3L2S&null|Son_test_button_event|L2SEvent.ACTI
#ON|Son_text_button_8|L2SEvent.BUTTON_PRESS|Son_text_button_8p|SClass V
#ariable|I1SParent Component|X46SNo click focus|NSAccepts focus Flag|I1
#SIs Checked Flag|NSIs Checkbox Flag|NSParent CheckBoxGroup|NSParent Bu
#tton Group|NSPaint|CCanvasTextPaint|I6SParent Canvas|X1SName|Spaint_9|
#SClass Name|STextPaint|SImport Name|Sgui|SClass Variable|NSStr|STest|S
#Paint down|NSInitial Focus|NSEvent Handlers|L1L2SEvent.WINDOW_CLOSE_BU
#TTON|Sdispose|SLayout delegate|CCanvasGridLayout|I8SDII val|NSDOI val|
#NSExtra|Scells|SName|Slayout_2|SClass Name|SGridLayout|SImport Name|Sg
#ui|SClass Variable|NSParent|X1
