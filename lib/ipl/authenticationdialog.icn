package ipl.browser

import
   gui

class AuthenticationDialog(Dialog)
   private
      user_name_field,
      password_field,
      site_label

   private readable
      result

   public component_setup()
   end

   public end_dialog()
   end

   public init_dialog()
   end

   public new(site)
      cast(self,Dialog).new()
      self.setup()
      if *site > 60 then
         site[58:0] := "..."
      site_label.set_label(site)
      password_field.set_displaychar("*")
      return
   end

   private on_cancel_button(ev)
      dispose()
   end

   private on_okay_button(ev)
      result := Authentication(user_name_field.get_contents(), password_field.get_contents())
      dispose()
   end

   private setup()
      local paint_2, label_2, okay_button, paint_11, layout_4, layout_1, paint_1, paint_9, panel_1, label_1, paint_10, panel_3, label_3, cancel_button, paint_12, layout_5
      self.set_label("Authentication required")
      self.set_resize(&yes)
      paint_11 := TextPaint("Site")
      label_3 := Label().
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_paint(paint_11)
      paint_12 := TextPaint("")
      site_label := Label().
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_align", Align.L).
         set_constraint("x_fill", &yes).
         set_paint(paint_12)
      paint_1 := TextPaint("User name")
      label_1 := Label().
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_paint(paint_1)
      user_name_field := TextField().
         set_size("282").
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_align", Align.L).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         connect(self.on_okay_button, Event.ACTION).
         set_contents("")
      paint_2 := TextPaint("Password")
      label_2 := Label().
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_paint(paint_2)
      password_field := TextField().
         set_size("60").
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         connect(self.on_okay_button, Event.ACTION).
         set_contents("")
      layout_1 := GridLayout().
         set_doi(0).
         set_extra("cells")
      panel_1 := Panel().
         clear_constraints().
         set_constraint("eol", &yes).
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_constraint("y_weight", 0.0).
         set_layout(layout_1).
         add(label_3).
         add(site_label).
         add(label_1).
         add(user_name_field).
         add(label_2).
         add(password_field)
      self.add(panel_1)
      paint_9 := TextPaint("Okay")
      okay_button := TextButton().
         set_align(Align.L, Align.B).
         clear_constraints().
         connect(self.on_okay_button, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_9)
      paint_10 := TextPaint("Cancel")
      cancel_button := TextButton().
         set_align(Align.L, Align.B).
         clear_constraints().
         set_constraint("x_align", Align.L).
         set_constraint("x_weight", 1.0).
         connect(self.on_cancel_button, Event.ACTION).
         set_toggles(&no).
         set_paint(paint_10)
      layout_4 := GridLayout().
         set_doi(0).
         set_extra("cells")
      panel_3 := Panel().
         clear_constraints().
         set_constraint("x_fill", &yes).
         set_constraint("x_weight", 1.0).
         set_layout(layout_4).
         add(okay_button).
         add(cancel_button)
      self.add(panel_3)
      layout_5 := GridLayout().
         set_extra("cells")
      self.set_layout(layout_5)
      self.set_focus(user_name_field.find_focus())
   end
end

procedure main()
   local d
   d := AuthenticationDialog("Increased availability of consumer goods was an important goal of perestroika. A premise of that program was that workers would raise their productivity")
   d.show_modal()
end

### Ivib-v2 layout: layouts/$.layout
