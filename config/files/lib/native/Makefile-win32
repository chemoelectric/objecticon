include ../../Makedefs

TARGET=

ifneq (@OPENSSL@,)
  TARGET:=$(TARGET) objecticonssllib.dll
endif
ifneq (@MYSQL@,)
  TARGET:=$(TARGET) objecticonmysqllib.dll
endif

all : $(TARGET)

mysql.obj : mysql.r
	$(RTT) -x -h gmysql.h mysql.r
	$(CC) $(CFLAGS) /LD /I @MYSQL_INCLUDE_DIR@ /c mysql.c
	$(RM) mysql.c

# These libraries are only needed for a static linking build, but seem to have no
# effect on a dynamic build.
LIBS=	wsock32.lib mswsock.lib advapi32.lib user32.lib gdi32.lib

objecticonmysqllib.dll : mysql.obj
	$(LD) $(LDFLAGS) /DLL mysql.obj \
	      $(LIBS) \
	      @MYSQL_LIBS@ \
              /OUT:$@

ssl.obj : ssl.r
	$(RTT) -x -h gssl.h ssl.r
	$(CC) $(CFLAGS) /I @OPENSSL_INCLUDE_DIR@ /c ssl.c
	$(RM) ssl.c

# These libraries are only needed for a static linking build, but seem to have no
# effect on a dynamic build.
LIBS=	wsock32.lib mswsock.lib advapi32.lib user32.lib gdi32.lib

objecticonssllib.dll : ssl.obj
	$(LD) $(LDFLAGS) /DLL ssl.obj \
	      $(LIBS) \
	      @OPENSSL_LIBS@ \
              /OUT:$@

clean :
	$(RM) *.u *.obj *.lib *.exp *.pdb *.dll mysql.c ipc.c cairo.c ssl.c
