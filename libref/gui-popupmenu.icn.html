<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>popupmenu.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: popupmenu.icn 8791 2020-12-28 13:35:33Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>#
<a name="12"/># This is a class for popup menus.  It is an invisible placeholder
<a name="13"/># component, with zero size, from which a Menu can be popped up
<a name="14"/># using the `popup()` method.
<a name="15"/>#
<a name="16"/># Note that instances should never be added or removed from a dialog;
<a name="17"/># that is done automatically.
<a name="18"/>#
<a name="19"/>class PopupMenu(Component, MenuSystem)
<a name="20"/>   public 
<a name="21"/>      menu,
<a name="22"/>      comp,
<a name="23"/>      # If the menu was closed via a selection, this is set to the
<a name="24"/>      # relevant `MenuComponent`.
<a name="25"/>      selected
<a name="26"/>
<a name="27"/>   public override go_right()
<a name="28"/>   end
<a name="29"/>
<a name="30"/>   public override go_left()
<a name="31"/>   end
<a name="32"/>
<a name="33"/>   public close_menu()
<a name="34"/>      self.menu.hide()
<a name="35"/>      self.menu.set_component_link(&amp;null)         
<a name="36"/>      self.menu.finally()
<a name="37"/>      self.parent_dialog.exit_menu_mode(self)
<a name="38"/>      self.parent.remove(self)
<a name="39"/>      self.comp := self.menu := &amp;null
<a name="40"/>      fire(Event.POPUP_CLOSED)
<a name="41"/>      link
<a name="42"/>   end
<a name="43"/>
<a name="44"/>   public override close_all(v)
<a name="45"/>      selected := v
<a name="46"/>      close_menu()
<a name="47"/>   end
<a name="48"/>
<a name="49"/>   public override make_partial()
<a name="50"/>      close_menu()
<a name="51"/>   end
<a name="52"/>
<a name="53"/>   public override should_close(e)
<a name="54"/>      return
<a name="55"/>   end
<a name="56"/>
<a name="57"/>   public override allow_nested(c)
<a name="58"/>      succeed is(c, SubMenuProxyComponent) &amp; c.menu.parent_component === self
<a name="59"/>   end
<a name="60"/>
<a name="61"/>   public override gen_popup_components()
<a name="62"/>   end
<a name="63"/>
<a name="64"/>   public override get_nesting_component()
<a name="65"/>      return comp
<a name="66"/>   end
<a name="67"/>
<a name="68"/>   #
<a name="69"/>   # Popup a menu.  The use of the alternate positions is described in
<a name="70"/>   # `MenuComponent.show()`.
<a name="71"/>   #
<a name="72"/>   # :Parameters :
<a name="73"/>   # :  `comp` - The component to temporarily add the menu to
<a name="74"/>   # :  `menu` - The menu to show
<a name="75"/>   # :  `x` - The x position to show
<a name="76"/>   # :  `y` - The y position to show
<a name="77"/>   # :  `xa` - The alternate x position to show; defaults to `x`.
<a name="78"/>   # :  `ya` - The alternate y position to show; defaults to `&amp;null`).
<a name="79"/>   #
<a name="80"/>   public popup(comp, menu, x, y, a[])
<a name="81"/>      local xa, ya
<a name="82"/>      xa := a[1] | x
<a name="83"/>      ya := a[2]
<a name="84"/>      self.comp := comp
<a name="85"/>      set_wattrib_ancestor(comp.parent_dialog.popup_manager)
<a name="86"/>      comp.parent_dialog.add(self)
<a name="87"/>      self.resize()
<a name="88"/>      unless self.parent_dialog.enter_menu_mode(self) then {
<a name="89"/>         parent.remove(self)
<a name="90"/>         self.comp := &amp;null
<a name="91"/>         fail
<a name="92"/>      }
<a name="93"/>      self.selected := &amp;null
<a name="94"/>      self.menu := menu
<a name="95"/>      self.menu.set_component_link(self)         
<a name="96"/>      self.menu.initially()
<a name="97"/>      self.menu.show(x, y, xa, ya)
<a name="98"/>      fire(Event.POPUP_OPENED)
<a name="99"/>      link
<a name="100"/>   end
<a name="101"/>
<a name="102"/>   public override new()
<a name="103"/>      Component.new()
<a name="104"/>      self.x_spec := self.y_spec := self.w_spec := self.h_spec := 0
<a name="105"/>      set_is_hidden(&amp;yes)
<a name="106"/>      return
<a name="107"/>   end
<a name="108"/>end
</pre></body></html>
