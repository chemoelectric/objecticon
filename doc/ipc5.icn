import
   io(write),
   ipc(Msg),
   util(Process)

global mq

procedure run()
   local i
   every i := 1 to 10 do {
      # Send the message
      mq.send(i)

      # Sleep for 1/2 second
      delay(500)
   }
end

procedure main()
   local i, c

   mq := Msg.create_private()

   c := Process{run()}
   c.start()

   repeat {
      i := mq.receive()
      write(i)
      if i = 10 then 
         break
   }
   c.close()
   mq.close()

   write("Finished")
end
