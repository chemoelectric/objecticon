<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>speedo.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#	File:     speedo.icn
<a name="4"/>#
<a name="5"/>#	Subject:  Procedure to indcate percentage of completion
<a name="6"/>#
<a name="7"/>#	Author:   Robert J. Alexander
<a name="8"/>#
<a name="9"/>#	Date:     May 2, 2001
<a name="10"/>#
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/># speedo -- a "percentage complete" graphic indicator for 
<a name="18"/># command-line-oriented user interfaces.
<a name="19"/>#
<a name="20"/># This is a general facility that can function for anything, and a
<a name="21"/># specific implementation for input files.
<a name="22"/>#
<a name="23"/># The general implementation consists of two procedures:
<a name="24"/>#
<a name="25"/>#       SpeedoNew -- Starts a speedo
<a name="26"/>#       SpeedoValue -- Sets a new value for the speedo (non-decreasing)
<a name="27"/>#
<a name="28"/># See FileSpeedo for an example of using the general facility.
<a name="29"/>#
<a name="30"/># FileSpeedo is especially for input files.  Here is how to use it, by
<a name="31"/># example:
<a name="32"/>#
<a name="33"/>#   f := open("input_file") | stop("!!!")
<a name="34"/>#   FileSpeedo(f,75)            # Start a file speedo, specifying
<a name="35"/>#                                       # length and output file
<a name="36"/>#   while read(f) do {
<a name="37"/>#      FileSpeedo(f)                    # Keep it updated while reading file
<a name="38"/>#      ...
<a name="39"/>#      }
<a name="40"/>#   FileSpeedo()                        # Finish up
<a name="41"/>#
<a name="42"/>############################################################################
<a name="43"/>
<a name="44"/>package ipl.speedo
<a name="45"/>
<a name="46"/>import
<a name="47"/>   io(write, writes)
<a name="48"/>
<a name="49"/>record SpeedoRec(max,length,file,lastOut,string)
<a name="50"/>
<a name="51"/>procedure SpeedoNew(max,length,file,str)
<a name="52"/>    /length := 79
<a name="53"/>    /str := "="
<a name="54"/>    write(file,"|",repl("-",length / *str * *str - 2),"|")
<a name="55"/>    return SpeedoRec(max,length,file,0,str)
<a name="56"/>end
<a name="57"/>
<a name="58"/>procedure SpeedoValue(self,value)
<a name="59"/>    local len
<a name="60"/>    if /value then {
<a name="61"/>	 write(self.file)
<a name="62"/>	 return
<a name="63"/>	    }
<a name="64"/>    len := self.length * value / self.max / *self.string
<a name="65"/>    if len &gt; self.lastOut then {
<a name="66"/>	 writes(self.file,repl(self.string,len - self.lastOut))
<a name="67"/>	 self.lastOut := len
<a name="68"/>	    }
<a name="69"/>    return self
<a name="70"/>end
<a name="71"/>
<a name="72"/>procedure FileSpeedo(file,length,outFile,str)
<a name="73"/>    local savePos, fileSize
<a name="74"/>    static speedo
<a name="75"/>    if /file then {
<a name="76"/>	 SpeedoValue(speedo)
<a name="77"/>	 return
<a name="78"/>	    }
<a name="79"/>    if \length then {
<a name="80"/>	 savePos := file.tell()
<a name="81"/>	 file.seek(0)
<a name="82"/>	 fileSize := file.tell()
<a name="83"/>	 file.seek(savePos)
<a name="84"/>	 return speedo := SpeedoNew(fileSize,length,outFile,str)
<a name="85"/>	    }
<a name="86"/>    return SpeedoValue(speedo,file.tell())
<a name="87"/>end
</pre></body></html>
