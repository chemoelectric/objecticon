<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>stripcom.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#	File:     stripcom.icn
<a name="4"/>#
<a name="5"/>#	Subject:  Procedures to strip comments from Icon line
<a name="6"/>#
<a name="7"/>#	Author:   Richard L. Goerwitz
<a name="8"/>#
<a name="9"/>#	Date:	  March 3, 1996
<a name="10"/>#
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/>#	Version:  1.5
<a name="18"/>#
<a name="19"/>############################################################################
<a name="20"/>#  
<a name="21"/>#  Strip commented-out portion of a line of Icon code.  Fails on lines
<a name="22"/>#  which, either stripped or otherwise, come out as an empty string.
<a name="23"/>#
<a name="24"/>############################################################################
<a name="25"/>#
<a name="26"/>#  BUGS:  Can't handle lines ending in an underscore as part of a
<a name="27"/>#  broken string literal, since stripcom is not intended to be used
<a name="28"/>#  on sequentially read files.  It simply removes comments from indi-
<a name="29"/>#  vidual lines.
<a name="30"/>#
<a name="31"/>############################################################################
<a name="32"/>
<a name="33"/>
<a name="34"/># To preserve parallelism between file and procedure names.
<a name="35"/>package ipl.stripcom
<a name="36"/>
<a name="37"/>procedure stripcom(s)
<a name="38"/>    return strip_comments(s)
<a name="39"/>end
<a name="40"/>
<a name="41"/>
<a name="42"/># The original name -
<a name="43"/>procedure strip_comments(s)
<a name="44"/>
<a name="45"/>    local   c, c2, s2
<a name="46"/>
<a name="47"/>    s ? {
<a name="48"/>	tab(many(' \t'))
<a name="49"/>	pos(0) &amp; fail
<a name="50"/>        find("#") | (return trim(tab(0),' \t'))
<a name="51"/>	match("#") &amp; fail
<a name="52"/>	(s2 &lt;- tab(find("#"))) ? {
<a name="53"/>	    c2 := &amp;null
<a name="54"/>	    while tab(upto('\\"\'')) do {
<a name="55"/>		case c := move(1) of {
<a name="56"/>		    "\\"   : {
<a name="57"/>			if match("^")
<a name="58"/>			then move(2)
<a name="59"/>			else move(1)
<a name="60"/>		    }
<a name="61"/>		    default: {
<a name="62"/>			if \c2
<a name="63"/>			then (c == c2, c2 := &amp;null)
<a name="64"/>			else c2 := c
<a name="65"/>		    }
<a name="66"/>		}
<a name="67"/>	    }
<a name="68"/>	    /c2
<a name="69"/>	}
<a name="70"/>	return "" ~== trim((\s2 | tab(0)) \ 1, ' \t')
<a name="71"/>    }
<a name="72"/>
<a name="73"/>end
</pre></body></html>
