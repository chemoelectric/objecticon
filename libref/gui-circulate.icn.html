<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>circulate.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: circulate.icn 8656 2020-11-08 19:36:43Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>import graphics, ipl.pdco
<a name="12"/>
<a name="13"/>class CirculateLabel(Label)
<a name="14"/>   public override keeps(e)
<a name="15"/>      succeed member(Key.CURSOR_V, e.code)
<a name="16"/>   end
<a name="17"/>
<a name="18"/>   public on_key(e)
<a name="19"/>      case e.code of {
<a name="20"/>         Key.UP : parent.go_up(e)
<a name="21"/>         Key.DOWN : parent.go_down(e)
<a name="22"/>         Key.HOME : parent.go_to(1, e)
<a name="23"/>         Key.END : parent.go_to(*parent.selection_list, e)
<a name="24"/>      }
<a name="25"/>   end
<a name="26"/>
<a name="27"/>   public override new()
<a name="28"/>      Label.new()
<a name="29"/>      self.set_label("")
<a name="30"/>      connect(self.on_key, Event.KEY_PRESS)
<a name="31"/>      # Align with the text in the textlist.
<a name="32"/>      self.set_border(EmptyBorder().
<a name="33"/>                      set_x_align(Align.L).
<a name="34"/>                      set_l_inset(Gui.TEXT_INSET).
<a name="35"/>                      set_r_inset(Gui.TEXT_INSET))
<a name="36"/>      return
<a name="37"/>   end
<a name="38"/>end
<a name="39"/>
<a name="40"/>
<a name="41"/>#
<a name="42"/># Selection from a list
<a name="43"/>#
<a name="44"/>class Circulate(SelectionList, Component, HasUseWheel)
<a name="45"/>   public
<a name="46"/>      old_selection, 
<a name="47"/>      b,
<a name="48"/>      l
<a name="49"/>
<a name="50"/>   private static init()
<a name="51"/>      local sz
<a name="52"/>      sz := scale(12)
<a name="53"/>      ImageCache.copy_key_with_resize("gui.CIRCULATE", "gui.CIRCULATE_12", sz, sz)
<a name="54"/>   end
<a name="55"/>
<a name="56"/>   public override apply_selection()
<a name="57"/>      local s
<a name="58"/>      s := self.selection_list[\self.selection] | ""
<a name="59"/>      self.l.set_label(s)
<a name="60"/>   end
<a name="61"/>
<a name="62"/>   public override get_default_height(dw)
<a name="63"/>      dw -:= border.get_total_width() + b.get_preferred_width()
<a name="64"/>      return border.get_total_height() + l.get_preferred_height(dw)
<a name="65"/>   end
<a name="66"/>
<a name="67"/>   public override get_default_width()
<a name="68"/>      return border.get_total_width() +
<a name="69"/>         b.get_preferred_width() +
<a name="70"/>         MaxNN{ self.cbwin.text_width(!self.selection_list) } +
<a name="71"/>         l.border.get_total_width()
<a name="72"/>   end
<a name="73"/>
<a name="74"/>   public override layout()
<a name="75"/>      #
<a name="76"/>      # Set button position and size
<a name="77"/>      #
<a name="78"/>      b.x := self.x + border.get_l_inset()
<a name="79"/>      l.y := b.y := self.y + border.get_t_inset()
<a name="80"/>      l.h := b.h := self.h - border.get_total_height()
<a name="81"/>      b.w := b.get_preferred_width()
<a name="82"/>      l.x := b.x + b.w
<a name="83"/>      l.w := self.w - border.get_total_width() - b.w
<a name="84"/>      b.layout()
<a name="85"/>      l.layout()
<a name="86"/>   end
<a name="87"/>
<a name="88"/>   #
<a name="89"/>   # Display the object.
<a name="90"/>   #
<a name="91"/>   public override display()
<a name="92"/>      border.draw_rect(self.cbwin, self)
<a name="93"/>      display_children()
<a name="94"/>   end
<a name="95"/>
<a name="96"/>   public override focus_changed(e) 
<a name="97"/>      l.invalidate()
<a name="98"/>   end
<a name="99"/>
<a name="100"/>   #
<a name="101"/>   # The handler for the button - move the selection forward.
<a name="102"/>   #
<a name="103"/>   public on_button_pressed(ev)
<a name="104"/>      go_up(ev)
<a name="105"/>   end
<a name="106"/>
<a name="107"/>   public start_change(e)
<a name="108"/>      self.old_selection := self.selection
<a name="109"/>   end
<a name="110"/>
<a name="111"/>   public end_change(e)
<a name="112"/>      if self.old_selection ~=== self.selection then
<a name="113"/>         fire(Event.SELECTION_CHANGED, e)
<a name="114"/>   end
<a name="115"/>
<a name="116"/>   public go_down(e)
<a name="117"/>      start_change(e)
<a name="118"/>      decrement_selection(e)
<a name="119"/>      end_change(e)
<a name="120"/>   end
<a name="121"/>
<a name="122"/>   public go_up(e)
<a name="123"/>      start_change(e)
<a name="124"/>      increment_selection(e)
<a name="125"/>      end_change(e)
<a name="126"/>   end
<a name="127"/>
<a name="128"/>   public go_to(x, e)
<a name="129"/>      start_change(e)
<a name="130"/>      set_selection(x, e)
<a name="131"/>      end_change(e)
<a name="132"/>   end
<a name="133"/>
<a name="134"/>   public override handle_wheel_up(e)
<a name="135"/>      go_up(e)
<a name="136"/>   end
<a name="137"/>
<a name="138"/>   public override handle_wheel_down(e)
<a name="139"/>      go_down(e)
<a name="140"/>   end
<a name="141"/>
<a name="142"/>   public override initially()
<a name="143"/>      \self.selection_list | runerr("No selection list specified")
<a name="144"/>      Component.initially()
<a name="145"/>   end
<a name="146"/>
<a name="147"/>   public override new() 
<a name="148"/>      Component.new()
<a name="149"/>      self.set_border(SunkenBorder())
<a name="150"/>      self.preferred_focus := self.l := CirculateLabel()
<a name="151"/>      self.l.set_accepts_focus(&amp;yes)
<a name="152"/>      add(self.l)
<a name="153"/>      self.b := IconButton().
<a name="154"/>         set_accepts_focus(&amp;no).
<a name="155"/>         set_border(CompoundBorder().
<a name="156"/>                    set_outer(RaisedBorder()).
<a name="157"/>                    set_inner(EmptyBorder().
<a name="158"/>                              set_insets(scale(2), scale(2), Gui.UNIT, Gui.UNIT))).
<a name="159"/>         set_paint(ImagePaint().
<a name="160"/>                   set_cache("gui.CIRCULATE")).
<a name="161"/>         connect(self.on_button_pressed, Event.ACTION)
<a name="162"/>      add(self.b)
<a name="163"/>      set_use_wheel(&amp;yes)
<a name="164"/>      return
<a name="165"/>   end
<a name="166"/>end
</pre></body></html>
