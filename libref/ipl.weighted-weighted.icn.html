<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>weighted.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#       File:     weighted.icn
<a name="4"/>#
<a name="5"/>#       Subject:  Procedure to shuffle list with randomness
<a name="6"/>#
<a name="7"/>#       Author:   Erik Eid
<a name="8"/>#
<a name="9"/>#       Date:     May 23, 1994
<a name="10"/>#
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/>#     WeightedShuffle returns the list "sample" with only a portion of the
<a name="18"/># elements switched.  Examples:
<a name="19"/>#
<a name="20"/>#     L := WeightedShuffle (X, 100)   - returns a fully shuffled list
<a name="21"/>#     L := WeightedShuffle (X, 50)    - every other element is eligible to
<a name="22"/>#                                       be switched
<a name="23"/>#     L := WeightedShuffle (X, 25)    - every fourth element is shuffled
<a name="24"/>#     L := WeightedShuffle (X, 0)     - nothing is changed
<a name="25"/>#
<a name="26"/>#     The procedure will fail if the given percentage is not between 0 and
<a name="27"/># 100, inclusive, or if it is not a numeric value.
<a name="28"/>#
<a name="29"/>############################################################################
<a name="30"/>
<a name="31"/>package ipl.weighted
<a name="32"/>
<a name="33"/>procedure WeightedShuffle(sample, percentage)
<a name="34"/>local lcv, pairs, weight, size, newlist, legal, illegal
<a name="35"/>  numeric(percentage) | fail
<a name="36"/>  (0 &lt;= percentage &lt;= 100) | fail
<a name="37"/>  newlist := copy(sample)                  # Start with a copy of the
<a name="38"/>                                           # original list.
<a name="39"/>  size := *newlist
<a name="40"/>  legal := list()                          # This list will hold which
<a name="41"/>                                           # indices are valid choices for
<a name="42"/>                                           # the shuffle, amounting to the
<a name="43"/>                                           # selected percentage of all
<a name="44"/>                                           # elements.
<a name="45"/>  
<a name="46"/># There are two very similar methods used here.  I found that using only the
<a name="47"/># first one created some odd values for 50 &lt; percentage &lt; 100, so I mirrored
<a name="48"/># the technique to create a list of "bad" indices instead of a list of 
<a name="49"/># "good" indices that the random switch can choose from.
<a name="50"/>
<a name="51"/>  if ((percentage &lt;= 50) | (percentage = 100)) then {
<a name="52"/>    pairs := integer (size * percentage / 100)
<a name="53"/>                                           # Number of pairs to be switched.
<a name="54"/>    if pairs &gt; 0 then {                    # Makes sure to avoid division by
<a name="55"/>                                           # zero- occurs when there is no
<a name="56"/>                                           # need to shuffle.
<a name="57"/>      weight := integer ((real(size) / pairs) + 0.5)        
<a name="58"/>                                           # Holds increment used in
<a name="59"/>                                           # selective shuffling, rounded up.
<a name="60"/>      lcv := 1
<a name="61"/>      until lcv &gt; size do {
<a name="62"/>        put (legal, lcv)                   # These indices may be used in
<a name="63"/>                                           # the shuffle.
<a name="64"/>        lcv +:= weight
<a name="65"/>      }
<a name="66"/>    }
<a name="67"/>  }  
<a name="68"/>  else { # percentage &gt; 50
<a name="69"/>    pairs := integer (size * (100 - percentage) / 100)
<a name="70"/>                                           # Avoid switching this many pairs.
<a name="71"/>    if pairs &gt; 0 then {
<a name="72"/>      weight := integer (size / pairs)     # Increment, rounded down.
<a name="73"/>      illegal := set ([])                  # Which indices can't be used?
<a name="74"/>      lcv := 1
<a name="75"/>      until lcv &gt; size do {
<a name="76"/>        illegal ++:= set(lcv)            # Compile the list of invaild
<a name="77"/>                                           # indices.
<a name="78"/>        lcv +:= weight
<a name="79"/>      }
<a name="80"/>      every lcv := 1 to size do            # Whatever isn't bad is good.
<a name="81"/>        member (illegal, lcv) | put (legal, lcv)
<a name="82"/>    }
<a name="83"/>  }
<a name="84"/>  every newlist[!legal] :=: newlist[?legal]
<a name="85"/>                                           # Shuffle elements only from
<a name="86"/>                                           # legal indices.
<a name="87"/>  return newlist
<a name="88"/>end
<a name="89"/>
</pre></body></html>
