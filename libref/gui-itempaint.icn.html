<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>itempaint.icn</title></head><body><pre>
<a name="1"/>package gui
<a name="2"/>
<a name="3"/>import util
<a name="4"/>
<a name="5"/>#
<a name="6"/># An `ItemPaint` is an object which can be used in a component which
<a name="7"/># needs to display many pieces of data in a similar way (for example
<a name="8"/># the nodes in a tree or the rows in a table column.  An single
<a name="9"/># instance of `ItemPaint` is used to give size information about each
<a name="10"/># piece data, and to draw it.
<a name="11"/>#
<a name="12"/>abstract class ItemPaint()
<a name="13"/>   #
<a name="14"/>   # Initialize the instance
<a name="15"/>   # :Parameters :
<a name="16"/>   # :  `c` - The owning `Component`
<a name="17"/>   public initially(c)
<a name="18"/>   end
<a name="19"/>
<a name="20"/>   #
<a name="21"/>   # Return the width of the given data.  Implementing this method is
<a name="22"/>   # not necessary if `get_constant_width` is overridden instead.
<a name="23"/>   #
<a name="24"/>   # :Parameters :
<a name="25"/>   # :  `W` - The window to use for text metrics
<a name="26"/>   # :  `data` - The data item
<a name="27"/>   #
<a name="28"/>   public optional get_width(W, data)
<a name="29"/>
<a name="30"/>   #
<a name="31"/>   # Return the height of the given data.  Implementing this method is
<a name="32"/>   # not necessary if `get_constant_height` is overridden instead.
<a name="33"/>   #
<a name="34"/>   # :Parameters :
<a name="35"/>   # :  `W` - The window to use for text metrics
<a name="36"/>   # :  `data` - The data item
<a name="37"/>   #
<a name="38"/>   public optional get_height(W, data)
<a name="39"/>
<a name="40"/>   #
<a name="41"/>   # Return the size of the given data, as a `Size` instance.
<a name="42"/>   # :Parameters :
<a name="43"/>   # :  `W` - The window to use for text metrics
<a name="44"/>   # :  `data` - The data item
<a name="45"/>   #
<a name="46"/>   public abstract get_size(W, data)
<a name="47"/>
<a name="48"/>   #
<a name="49"/>   # Draw the given data item
<a name="50"/>   # :Parameters :
<a name="51"/>   # :  `W` - The window to draw into
<a name="52"/>   # :  `data` - The data item
<a name="53"/>   # :  `x` - The x position
<a name="54"/>   # :  `y` - The y position
<a name="55"/>   # :  `w` - The available output width
<a name="56"/>   # :  `h` - The available output height
<a name="57"/>   #
<a name="58"/>   public abstract draw(W, data, x, y, w, h)
<a name="59"/>
<a name="60"/>   #
<a name="61"/>   # This method should be implemented if it is known that all data
<a name="62"/>   # items will have the same width.
<a name="63"/>   # :Parameters :
<a name="64"/>   # :  `W` - The window to use for text metrics
<a name="65"/>   #
<a name="66"/>   public get_constant_width(W)
<a name="67"/>   end
<a name="68"/>
<a name="69"/>   #
<a name="70"/>   # This method should be implemented if it is known that all data
<a name="71"/>   # items will have the same height.
<a name="72"/>   # :Parameters :
<a name="73"/>   # :  `W` - The window to use for text metrics
<a name="74"/>   #
<a name="75"/>   public get_constant_height(W)
<a name="76"/>   end
<a name="77"/>
<a name="78"/>   #
<a name="79"/>   # Convenient method to draw at a given point with size limit; just calls `draw`.
<a name="80"/>   # :Parameters :
<a name="81"/>   # :  `W` - The window to draw into
<a name="82"/>   # :  `data` - The data item
<a name="83"/>   # :  `p` - The `Rect`, giving the point to draw at, and the
<a name="84"/>   #          height/width limitation.
<a name="85"/>   #
<a name="86"/>   public draw_rect(W, data, r)
<a name="87"/>      self.draw(W, data, r.x, r.y, r.w, r.h)
<a name="88"/>   end
<a name="89"/>
<a name="90"/>   #
<a name="91"/>   # Cleanup any resources used by this instance.
<a name="92"/>   #
<a name="93"/>   public finally()
<a name="94"/>   end
<a name="95"/>end
<a name="96"/>
<a name="97"/>#
<a name="98"/># An `ItemPaint` in which each piece of data is an instance of
<a name="99"/># `Paint`.
<a name="100"/>#
<a name="101"/>class PaintAdapter(ItemPaint)
<a name="102"/>   public override get_width(W, data)
<a name="103"/>      return data.w
<a name="104"/>   end
<a name="105"/>
<a name="106"/>   public override get_height(W, data)
<a name="107"/>      return data.h
<a name="108"/>   end
<a name="109"/>
<a name="110"/>   public override get_size(W, data)
<a name="111"/>      return data
<a name="112"/>   end
<a name="113"/>
<a name="114"/>   public override draw(W, data, x, y, w, h)
<a name="115"/>      data.draw(W, x, y, w, h)
<a name="116"/>   end
<a name="117"/>end
<a name="118"/>
<a name="119"/>#
<a name="120"/># A simple `ItemPaint` in which each piece of data is a string.
<a name="121"/>#
<a name="122"/>class TextItemPaint(ItemPaint)
<a name="123"/>   public override get_width(W, data)
<a name="124"/>      return W.text_width(detab(data))
<a name="125"/>   end
<a name="126"/>
<a name="127"/>   public override get_constant_height(W)
<a name="128"/>      return W.get_line_height()
<a name="129"/>   end
<a name="130"/>
<a name="131"/>   public override get_size(W, data)
<a name="132"/>      return Size(W.text_width(detab(data)), W.get_line_height())
<a name="133"/>   end
<a name="134"/>
<a name="135"/>   public override draw(W, data, x, y)
<a name="136"/>      W.draw_string(x, y + W.get_line_ascent(), detab(data))
<a name="137"/>   end
<a name="138"/>end
<a name="139"/>
<a name="140"/>#
<a name="141"/># A simple `ItemPaint` in which each piece of data is a string.  If
<a name="142"/># the string is limited when output, then a truncated string ending in
<a name="143"/># "..." is output.
<a name="144"/>#
<a name="145"/>class AbbreviatedTextItemPaint(TextItemPaint)
<a name="146"/>   public override draw(W, data, x, y, w)
<a name="147"/>      W.draw_string(x, y + W.get_line_ascent(), limit_text(W, detab(data), w))
<a name="148"/>   end
<a name="149"/>end
<a name="150"/>
<a name="151"/>#
<a name="152"/># An `ItemPaint` which wraps another `ItemPaint`.  The window seen by
<a name="153"/># the wrapped instance is a clone of the one provided in the calls to
<a name="154"/># this instance.  The clone is created by the `make_clone()` method,
<a name="155"/># which must be provided by a subclass.
<a name="156"/>#
<a name="157"/>abstract class WithCloneItemPaint(CachedClone, ItemPaint)
<a name="158"/>   public const
<a name="159"/>      other
<a name="160"/>
<a name="161"/>   public override initially(c)
<a name="162"/>      other.initially(c)
<a name="163"/>   end
<a name="164"/>
<a name="165"/>   public override get_width(W, data)
<a name="166"/>      return other.get_width(get_clone(W, &amp;yes), data)
<a name="167"/>   end
<a name="168"/>
<a name="169"/>   public override get_height(W, data)
<a name="170"/>      return other.get_height(get_clone(W, &amp;yes), data)
<a name="171"/>   end
<a name="172"/>
<a name="173"/>   public override get_size(W, data)
<a name="174"/>      return other.get_size(get_clone(W, &amp;yes), data)
<a name="175"/>   end
<a name="176"/>
<a name="177"/>   public override draw(W, data, x, y, w, h)
<a name="178"/>      other.draw(get_clone(W), data, x, y, w, h)
<a name="179"/>   end
<a name="180"/>
<a name="181"/>   public override get_constant_height(W)
<a name="182"/>      return other.get_constant_height(get_clone(W, &amp;yes))
<a name="183"/>   end
<a name="184"/>
<a name="185"/>   public override get_constant_width(W)
<a name="186"/>      return other.get_constant_width(get_clone(W, &amp;yes))
<a name="187"/>   end
<a name="188"/>
<a name="189"/>   public override finally()
<a name="190"/>      other.finally()
<a name="191"/>      close()
<a name="192"/>   end
<a name="193"/>
<a name="194"/>   #
<a name="195"/>   # Create a new instance with the given `ItemPaint` to wrap.
<a name="196"/>   #
<a name="197"/>   public new(other)
<a name="198"/>      self.other := other
<a name="199"/>      return
<a name="200"/>   end
<a name="201"/>end
<a name="202"/>
<a name="203"/>#
<a name="204"/># An `ItemPaint` in which each piece of data is a Pixels instance.
<a name="205"/>#
<a name="206"/>class PixelsItemPaint(ItemPaint)
<a name="207"/>   public override get_width(W, data)
<a name="208"/>      return data.get_width()
<a name="209"/>   end
<a name="210"/>
<a name="211"/>   public override get_height(W, data)
<a name="212"/>      return data.get_height()
<a name="213"/>   end
<a name="214"/>
<a name="215"/>   public override get_size(W, data)
<a name="216"/>      return Size(data.get_width(), data.get_height())
<a name="217"/>   end
<a name="218"/>
<a name="219"/>   public override draw(W, data, x, y)
<a name="220"/>      W.draw_image(x, y, data)
<a name="221"/>   end
<a name="222"/>end
<a name="223"/>
<a name="224"/>#
<a name="225"/># An `ItemPaint` in which each piece of data is a window containing an
<a name="226"/># image to be copied to the destination.  It is the responsibility of
<a name="227"/># the user to initialize and dispose of the windows.
<a name="228"/>#
<a name="229"/>class ImageWindowItemPaint(ItemPaint)
<a name="230"/>   public override get_width(W, data)
<a name="231"/>      return data.get_width()
<a name="232"/>   end
<a name="233"/>
<a name="234"/>   public override get_height(W, data)
<a name="235"/>      return data.get_height()
<a name="236"/>   end
<a name="237"/>
<a name="238"/>   public override get_size(W, data)
<a name="239"/>      return Size(data.get_width(), data.get_height())
<a name="240"/>   end
<a name="241"/>
<a name="242"/>   public override draw(W, data, x, y)
<a name="243"/>      data.copy_to(,,,, W, x, y)
<a name="244"/>   end
<a name="245"/>end
<a name="246"/>
<a name="247"/>#
<a name="248"/># An `ItemPaint` in which each piece of data is a key to be given to
<a name="249"/># `ImageCache.get`.  The resulting image is then copied to the
<a name="250"/># destination.
<a name="251"/>#
<a name="252"/>class ImageCacheItemPaint(ItemPaint)
<a name="253"/>   public override get_width(W, data)
<a name="254"/>      return ImageCache.get(data, W).get_width() | 0
<a name="255"/>   end
<a name="256"/>
<a name="257"/>   public override get_height(W, data)
<a name="258"/>      return ImageCache.get(data, W).get_height() | 0
<a name="259"/>   end
<a name="260"/>
<a name="261"/>   public override get_size(W, data)
<a name="262"/>      local i
<a name="263"/>      return if i := ImageCache.get(data, W) then
<a name="264"/>         Size(i.get_width(), i.get_height())
<a name="265"/>      else
<a name="266"/>         Size(0, 0)
<a name="267"/>   end
<a name="268"/>
<a name="269"/>   public override draw(W, data, x, y)
<a name="270"/>      ImageCache.get(data, W).copy_to(,,,, W, x, y)
<a name="271"/>   end
<a name="272"/>end
<a name="273"/>
<a name="274"/>#
<a name="275"/># An `ItemPaint` which wraps another `ItemPaint`.  Each item of data
<a name="276"/># is mapped using a provided function before being passed to the other
<a name="277"/># instance.
<a name="278"/>#
<a name="279"/>class MapItemPaint(ItemPaint)
<a name="280"/>   public const
<a name="281"/>      other, f
<a name="282"/>
<a name="283"/>   public override initially(c)
<a name="284"/>      other.initially(c)
<a name="285"/>   end
<a name="286"/>
<a name="287"/>   public override get_width(W, data)
<a name="288"/>      return other.get_width(W, f(data))
<a name="289"/>   end
<a name="290"/>
<a name="291"/>   public override get_height(W, data)
<a name="292"/>      return other.get_height(W, f(data))
<a name="293"/>   end
<a name="294"/>
<a name="295"/>   public override get_size(W, data)
<a name="296"/>      return other.get_size(W, f(data))
<a name="297"/>   end
<a name="298"/>
<a name="299"/>   public override draw(W, data, x, y, w, h)
<a name="300"/>      other.draw(W, f(data), x, y, w, h)
<a name="301"/>   end
<a name="302"/>
<a name="303"/>   public override get_constant_width(W)
<a name="304"/>      return other.get_constant_width(W)
<a name="305"/>   end
<a name="306"/>
<a name="307"/>   public override get_constant_height(W)
<a name="308"/>      return other.get_constant_height(W)
<a name="309"/>   end
<a name="310"/>
<a name="311"/>   public override finally()
<a name="312"/>      other.finally()
<a name="313"/>   end
<a name="314"/>
<a name="315"/>   #
<a name="316"/>   # Create a new instance with the given `ItemPaint` to wrap, and
<a name="317"/>   # map function `f`.
<a name="318"/>   #
<a name="319"/>   public new(other, f)
<a name="320"/>      self.other := other
<a name="321"/>      self.f := need_callable(f)
<a name="322"/>      return
<a name="323"/>   end
<a name="324"/>end
</pre></body></html>
