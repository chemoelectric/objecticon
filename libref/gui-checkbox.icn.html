<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>checkbox.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: checkbox.icn 7909 2019-10-09 18:42:01Z rparlett $
<a name="3"/>#
<a name="4"/># This file is in the public domain.
<a name="5"/>#
<a name="6"/># Author: Robert Parlett (parlett@dial.pipex.com)
<a name="7"/>#
<a name="8"/>
<a name="9"/>package gui
<a name="10"/>
<a name="11"/>#
<a name="12"/># An instance of this class is a small button with a label
<a name="13"/># which is either in an on or off state.  The button is an
<a name="14"/># Icon image, which may be specified by the user if desired.
<a name="15"/>#
<a name="16"/># The images will default to appropriate values if not specified.
<a name="17"/>#
<a name="18"/># The size will also default if not specified.  The methods
<a name="19"/># used to control the images, label and check the status are
<a name="20"/># inherited from the superclasses `Button` and `Toggle`.
<a name="21"/>#
<a name="22"/># Example :-
<a name="23"/># ~
<a name="24"/>#   c := CheckBox()
<a name="25"/>#   c.set_pos(200, 100)
<a name="26"/>#   c.set_label("Checkbox")
<a name="27"/>#   self.add(c)
<a name="28"/># ~
<a name="29"/>class CheckBox(Button)
<a name="30"/>   public
<a name="31"/>      unchecked_paint,
<a name="32"/>      checked_paint,
<a name="33"/>      tx, 
<a name="34"/>      tw, 
<a name="35"/>      paint
<a name="36"/>
<a name="37"/>   #
<a name="38"/>   # Set the up/down icons to the given (distinct) `Paint` instances.
<a name="39"/>   # The two images must have the same dimensions.
<a name="40"/>   # :Parameters :
<a name="41"/>   # :  `x` - The up image
<a name="42"/>   # :  `y` - The down image
<a name="43"/>   #
<a name="44"/>   public set_box_paint(x, y)
<a name="45"/>      if is_initialized() then {
<a name="46"/>         (\self.unchecked_paint).finally()
<a name="47"/>         (\self.checked_paint).finally()
<a name="48"/>         self.unchecked_paint := x
<a name="49"/>         self.checked_paint := y
<a name="50"/>         self.unchecked_paint.initially(self)
<a name="51"/>         self.checked_paint.initially(self)
<a name="52"/>         self.invalidate()
<a name="53"/>         unchecked_paint.w = checked_paint.h | runerr("Image widths differ")
<a name="54"/>         unchecked_paint.h = checked_paint.h | runerr("Image heights differ")
<a name="55"/>      } else {
<a name="56"/>         self.unchecked_paint := x
<a name="57"/>         self.checked_paint := y
<a name="58"/>      }
<a name="59"/>      link
<a name="60"/>   end
<a name="61"/>
<a name="62"/>   #
<a name="63"/>   # Set the label.
<a name="64"/>   # :Parameters :
<a name="65"/>   # :  `x` - The label.
<a name="66"/>   #
<a name="67"/>   public set_label(x)
<a name="68"/>      return set_paint(paint_for_string(x))
<a name="69"/>   end
<a name="70"/>
<a name="71"/>   public set_paint(p)
<a name="72"/>      if is_initialized() then {
<a name="73"/>         (\self.paint).finally()
<a name="74"/>         self.paint := p
<a name="75"/>         self.paint.initially(self, self.accel)
<a name="76"/>         self.invalidate()
<a name="77"/>      } else
<a name="78"/>         self.paint := p
<a name="79"/>      link
<a name="80"/>   end
<a name="81"/>
<a name="82"/>   public override initially()
<a name="83"/>      #
<a name="84"/>      # Set the icons if necessary
<a name="85"/>      #
<a name="86"/>      if /self.unchecked_paint then {
<a name="87"/>         if /self.parent_check_box_group then
<a name="88"/>            self.set_box_paint(ImagePaint().set_cache("gui.BOX_UP"), ImagePaint().set_cache("gui.BOX_DOWN"))
<a name="89"/>         else
<a name="90"/>            self.set_box_paint(ImagePaint().set_cache("gui.DIAMOND_UP"), ImagePaint().set_cache("gui.DIAMOND_DOWN"))
<a name="91"/>      }
<a name="92"/>      \self.paint | runerr("No label specified")
<a name="93"/>      Component.initially()
<a name="94"/>      self.paint.initially(self, self.accel)
<a name="95"/>      self.unchecked_paint.initially(self)
<a name="96"/>      self.checked_paint.initially(self)
<a name="97"/>      unchecked_paint.w = checked_paint.h | runerr("Image widths differ")
<a name="98"/>      unchecked_paint.h = checked_paint.h | runerr("Image heights differ")
<a name="99"/>   end
<a name="100"/>
<a name="101"/>   public override finally()
<a name="102"/>      Component.finally()
<a name="103"/>      paint.finally()
<a name="104"/>      unchecked_paint.finally()
<a name="105"/>      checked_paint.finally()
<a name="106"/>   end
<a name="107"/>
<a name="108"/>   public override get_default_width()
<a name="109"/>      #
<a name="110"/>      # We give extra border space; this looks better with the focus rectangle.
<a name="111"/>      #
<a name="112"/>      return paint.w + self.unchecked_paint.w + Gui.X_INSET + Gui.TEXT_INSET
<a name="113"/>   end
<a name="114"/>
<a name="115"/>   public override get_default_height()
<a name="116"/>      return max(paint.h, unchecked_paint.h)
<a name="117"/>   end
<a name="118"/>
<a name="119"/>   public override layout()
<a name="120"/>      self.tx := self.x + self.unchecked_paint.w + Gui.X_INSET
<a name="121"/>      self.tw := self.w - self.unchecked_paint.w - Gui.X_INSET - Gui.TEXT_INSET
<a name="122"/>   end
<a name="123"/>
<a name="124"/>   public override shift(dx, dy)
<a name="125"/>      Button.shift(dx, dy)
<a name="126"/>      tx +:= dx
<a name="127"/>   end
<a name="128"/>
<a name="129"/>   public override visualize_action(e)
<a name="130"/>      # For a checkbox, visualizing a keyboard action introduces a
<a name="131"/>      # slight delay and has no real advantage; so we just call
<a name="132"/>      # on_action directly.
<a name="133"/>      if /self.is_down then
<a name="134"/>         on_action(e)
<a name="135"/>   end
<a name="136"/>
<a name="137"/>   public override display()
<a name="138"/>      local i
<a name="139"/>
<a name="140"/>      if \self.is_down then
<a name="141"/>         i := if /self.is_checked_flag then checked_paint else unchecked_paint
<a name="142"/>      else
<a name="143"/>         i := if \self.is_checked_flag then checked_paint else unchecked_paint
<a name="144"/>
<a name="145"/>      #
<a name="146"/>      # Draw image and string centred vertically; image has unchecked_paint.w pixel to its right
<a name="147"/>      #
<a name="148"/>      i.draw(self.cbwin, self.x, self.y + (self.h - unchecked_paint.h) / 2)
<a name="149"/>      paint.draw(self.cbwin, self.tx, self.y + (self.h - paint.h) / 2)
<a name="150"/>
<a name="151"/>      if should_draw_focus() then
<a name="152"/>         Gui.style.draw_focus_rectangle(self.cbwin,
<a name="153"/>                                        self.tx - Gui.TEXT_INSET, self.y, 
<a name="154"/>                                        self.tw + 2 * Gui.TEXT_INSET, self.h)
<a name="155"/>   end
<a name="156"/>
<a name="157"/>   public override new()
<a name="158"/>      Button.new()
<a name="159"/>      self.toggles_flag := &amp;yes
<a name="160"/>      self.set_constraint("x_align", Align.L)
<a name="161"/>      return
<a name="162"/>   end
<a name="163"/>end
</pre></body></html>
