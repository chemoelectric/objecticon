<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>contentdisposition.icn</title></head><body><pre>
<a name="1"/>#
<a name="2"/># $Id: contentdisposition.icn 7415 2019-01-25 16:51:58Z rparlett $
<a name="3"/>#
<a name="4"/>
<a name="5"/>package mail
<a name="6"/>
<a name="7"/>import datastruct(SortTable), util(error), lang(Text)
<a name="8"/>
<a name="9"/>#
<a name="10"/># This class represents a content disposition
<a name="11"/>#
<a name="12"/>class ContentDisposition()
<a name="13"/>   private readable
<a name="14"/>      type,
<a name="15"/>      parameters
<a name="16"/>
<a name="17"/>   #
<a name="18"/>   # Set type type
<a name="19"/>   #
<a name="20"/>   public set_type(t)
<a name="21"/>      self.type := t
<a name="22"/>      link
<a name="23"/>   end
<a name="24"/>
<a name="25"/>   #
<a name="26"/>   # Get the type
<a name="27"/>   #
<a name="28"/>   public get_type()
<a name="29"/>      return .type
<a name="30"/>   end
<a name="31"/>
<a name="32"/>   #
<a name="33"/>   # Get the parameter for the given key.
<a name="34"/>   #
<a name="35"/>   # :Parameters :
<a name="36"/>   # :  `key` - the key
<a name="37"/>   public get_parameter(key)
<a name="38"/>      return parameters.member(key)
<a name="39"/>   end
<a name="40"/>
<a name="41"/>   #
<a name="42"/>   # Set the parameter to the given value
<a name="43"/>   # :Parameters :
<a name="44"/>   # :  `key` - the key
<a name="45"/>   # :  `value` - the value
<a name="46"/>   public set_parameter(key, value)
<a name="47"/>      parameters.insert(key, value)
<a name="48"/>      link
<a name="49"/>   end
<a name="50"/>
<a name="51"/>   private parameter_error(h, s)
<a name="52"/>      return error("Error parsing " || h || " parameter: " || image(s) || ": " || &amp;why)
<a name="53"/>   end
<a name="54"/>
<a name="55"/>   #
<a name="56"/>   # Get the "filename" parameter, or fail if absent
<a name="57"/>   #
<a name="58"/>   public get_filename()
<a name="59"/>      return get_parameter("filename") | error("Missing parameter: filename")
<a name="60"/>   end
<a name="61"/>
<a name="62"/>   #
<a name="63"/>   # Set the "filename" parameter.
<a name="64"/>   #
<a name="65"/>   public set_filename(v)
<a name="66"/>      set_parameter("filename", v)
<a name="67"/>      link
<a name="68"/>   end
<a name="69"/>
<a name="70"/>   #
<a name="71"/>   # Get the "creation-date" parameter as a `Time` object.
<a name="72"/>   # :Fails :
<a name="73"/>   # :  if the parameter is absent or cannot be parsed.
<a name="74"/>   # :Returns :
<a name="75"/>   # :  a `Time` instance
<a name="76"/>   #
<a name="77"/>   public get_creation_date()
<a name="78"/>      local s
<a name="79"/>      s := get_parameter("creation-date") | return error("Missing parameter: creation-date")
<a name="80"/>      return RFC822Parser().parse_date_time(s) | parameter_error("creation-date", s)
<a name="81"/>   end
<a name="82"/>
<a name="83"/>   #
<a name="84"/>   # Set the "creation-date" parameter from the given `Time` object.
<a name="85"/>   # :Parameters :
<a name="86"/>   # :  `t` - the `Time` from which to set the date field.
<a name="87"/>   #
<a name="88"/>   public set_creation_date(t)
<a name="89"/>      return set_parameter("creation-date", t.to_rfc822())
<a name="90"/>   end
<a name="91"/>
<a name="92"/>   #
<a name="93"/>   # Get the "modification-date" parameter as a `Time` object.
<a name="94"/>   # :Fails :
<a name="95"/>   # :  if the parameter is absent or cannot be parsed.
<a name="96"/>   # :Returns :
<a name="97"/>   # :  a `Time` instance
<a name="98"/>   #
<a name="99"/>   public get_modification_date()
<a name="100"/>      local s
<a name="101"/>      s := get_parameter("modification-date") | return error("Missing parameter: modification-date")
<a name="102"/>      return RFC822Parser().parse_date_time(s) | parameter_error("modification-date", s)
<a name="103"/>   end
<a name="104"/>
<a name="105"/>   #
<a name="106"/>   # Set the "modification-date" parameter from the given `Time` object.
<a name="107"/>   # :Parameters :
<a name="108"/>   # :  `t` - the `Time` from which to set the date field.
<a name="109"/>   #
<a name="110"/>   public set_modification_date(t)
<a name="111"/>      return set_parameter("modification-date", t.to_rfc822())
<a name="112"/>   end
<a name="113"/>
<a name="114"/>   #
<a name="115"/>   # Get the "read-date" parameter as a `Time` object.
<a name="116"/>   # :Fails :
<a name="117"/>   # :  if the parameter is absent or cannot be parsed.
<a name="118"/>   # :Returns :
<a name="119"/>   # :  a `Time` instance
<a name="120"/>   #
<a name="121"/>   public get_read_date()
<a name="122"/>      local s
<a name="123"/>      s := get_parameter("read-date") | return error("Missing parameter: read-date")
<a name="124"/>      return RFC822Parser().parse_date_time(s) | parameter_error("read-date", s)
<a name="125"/>   end
<a name="126"/>
<a name="127"/>   #
<a name="128"/>   # Set the "read-date" parameter from the given `Time` object.
<a name="129"/>   # :Parameters :
<a name="130"/>   # :  `t` - the `Time` from which to set the date field.
<a name="131"/>   #
<a name="132"/>   public set_read_date(t)
<a name="133"/>      return set_parameter("read-date", t.to_rfc822())
<a name="134"/>   end
<a name="135"/>
<a name="136"/>   #
<a name="137"/>   # Get the "size" parameter as an integer, or fail if it's absent or
<a name="138"/>   # not an integer.
<a name="139"/>   #
<a name="140"/>   public get_size()
<a name="141"/>      local s
<a name="142"/>      s := get_parameter("size") | return error("Missing parameter: size")
<a name="143"/>      return integer(s) | error("Parameter size: " || image(s) || ": Not an integer")
<a name="144"/>   end
<a name="145"/>
<a name="146"/>   #
<a name="147"/>   # Set the "size" parameter from the given integer.
<a name="148"/>   #
<a name="149"/>   public set_size(n)
<a name="150"/>      return set_parameter("size", string(integer(n)))
<a name="151"/>   end
<a name="152"/>
<a name="153"/>   public static parse(s)
<a name="154"/>      return RFC822Parser().parse_content_disposition(s)
<a name="155"/>   end   
<a name="156"/>
<a name="157"/>   public static parse_rfc2616(s)
<a name="158"/>      return RFC2616Parser().parse_content_disposition(s)
<a name="159"/>   end   
<a name="160"/>
<a name="161"/>   public to_rfc1521()
<a name="162"/>      local s, e
<a name="163"/>      s := type 
<a name="164"/>      every e := parameters.entries() do
<a name="165"/>         s ||:= "; " || e.key || "=" || RFC822Parser.escape_1521_value(e.val)
<a name="166"/>      return s
<a name="167"/>   end
<a name="168"/>
<a name="169"/>   public to_rfc2616()
<a name="170"/>      local s, e
<a name="171"/>      s := type 
<a name="172"/>      every e := parameters.entries() do
<a name="173"/>         s ||:= "; " || e.key || "=" || RFC2616Parser.escape_value(e.val)
<a name="174"/>      return s
<a name="175"/>   end
<a name="176"/>
<a name="177"/>   public new(type)
<a name="178"/>      self.type := type
<a name="179"/>      self.parameters := SortTable(, Text.caseless_compare)
<a name="180"/>      return
<a name="181"/>   end
<a name="182"/>end
</pre></body></html>
