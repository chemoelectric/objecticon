<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta charset="UTF-8"><title>getkeys.icn</title></head><body><pre>
<a name="1"/>############################################################################
<a name="2"/>#
<a name="3"/>#	File:     getkeys.icn
<a name="4"/>#
<a name="5"/>#	Subject:  Procedures to get keys for a gettext file
<a name="6"/>#
<a name="7"/>#	Author:   Richard L. Goerwitz
<a name="8"/>#
<a name="9"/>#	Date:     May 2, 2001
<a name="10"/>#	
<a name="11"/>############################################################################
<a name="12"/>#
<a name="13"/>#   This file is in the public domain.
<a name="14"/>#
<a name="15"/>############################################################################
<a name="16"/>#
<a name="17"/>#	Version:  1.2
<a name="18"/>#
<a name="19"/>############################################################################
<a name="20"/>#
<a name="21"/>#  Getkeys(FNAME) generates all keys in FNAME in order of occurrence.
<a name="22"/>#  See gettext.icn for a description of the requisite file structure
<a name="23"/>#  for FNAME.
<a name="24"/>#
<a name="25"/>############################################################################
<a name="26"/>#
<a name="27"/>#  Requires: UNIX (maybe MS-DOS; untested)
<a name="28"/>#
<a name="29"/>############################################################################
<a name="30"/>#
<a name="31"/>#  See also: gettext.icn
<a name="32"/>#
<a name="33"/>############################################################################
<a name="34"/>#
<a name="35"/>#  Links: adjuncts
<a name="36"/>#
<a name="37"/>############################################################################
<a name="38"/>
<a name="39"/>package ipl.getkeys
<a name="40"/>
<a name="41"/>import
<a name="42"/>   io(close, open, read, stop),
<a name="43"/>   ipl.adjuncts(Pathname, _baselen, _slash, getidxname)
<a name="44"/>
<a name="45"/>procedure getkeys(FNAME)
<a name="46"/>
<a name="47"/>    local line, intext, start_unindexed_part
<a name="48"/>    initial {
<a name="49"/>	if /_slash then {
<a name="50"/>	    if find("UNIX"|"Amiga", &amp;features) then {
<a name="51"/>		_slash := "/"
<a name="52"/>		_baselen := 10
<a name="53"/>	    }
<a name="54"/>	    else if find("MS-DOS", &amp;features) then {
<a name="55"/>		_slash := "\\"
<a name="56"/>		_baselen := 8
<a name="57"/>	    }
<a name="58"/>	    else stop("getkeys:  OS not supported")
<a name="59"/>	}
<a name="60"/>    }
<a name="61"/>
<a name="62"/>    /FNAME &amp; runerr("getkeys:  Null argument")
<a name="63"/>
<a name="64"/>    # Try to open index file (there may not be one).
<a name="65"/>    if intext := open(Pathname(FNAME) || getidxname(FNAME)) then {
<a name="66"/>	# If there's an index file, then just suspend all the keys in
<a name="67"/>	# it (i.e. suspend every line except the first, upto the tab).
<a name="68"/>	# The first line tells how many bytes in FNAME were indexed.
<a name="69"/>	# save it, and use it to seek to unindexed portions later on.
<a name="70"/>	start_unindexed_part := integer(read(intext))
<a name="71"/>	while line := read(intext) do
<a name="72"/>	    line ? suspend tab(find("\t")) \ 1
<a name="73"/>	close(intext)
<a name="74"/>    }
<a name="75"/>
<a name="76"/>    intext := open(FNAME) | stop("getkeys:  ",FNAME," not found")
<a name="77"/>    intext.seek(\start_unindexed_part | 1)
<a name="78"/>    while line := read(intext) do
<a name="79"/>	line ? { suspend (="::", tab(0)) \ 1 }
<a name="80"/>
<a name="81"/>    # Nothing left to suspend, so fail.
<a name="82"/>    fail
<a name="83"/>
<a name="84"/>end
<a name="85"/>
</pre></body></html>
